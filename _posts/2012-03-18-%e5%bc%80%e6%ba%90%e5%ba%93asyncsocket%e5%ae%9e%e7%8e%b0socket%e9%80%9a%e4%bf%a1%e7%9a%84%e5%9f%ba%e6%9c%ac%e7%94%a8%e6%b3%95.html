---
layout: post
title: 开源库AsyncSocket实现socket通信的基本用法
categories:
- program
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _sinaweibo_sync: 'true'
  _sinaweibo_sync_id: '3425058146099921'
  views: '37'
author:
  login: snorlax
  email: zhangxzheng@hotmail.com
  display_name: snorlax
  first_name: ''
  last_name: ''
---
<p><a href="https://snorlax.sinaapp.com/Document_Code/AsyncSocket.h">AsyncSocket.h</a><br />
<a href="https://snorlax.sinaapp.com/Document_Code/AsyncSocket.m">AsyncSocket.m</a></p>
<pre lang="objective-c">
- (BOOL)connectToHost:(NSString*)hostname onPort:(UInt16)port error:(NSError **)errPtr //connect to the server

- (void)writeData:(NSData *)data withTimeout:(NSTimeInterval)timeout tag:(long)tag //send data

- (void)onSocket:(AsyncSocket *)sock didReadData:(NSData *)data withTag:(long)tag //be called when the data was received

- (void)onSocketDidDisconnect:(AsyncSocket *)sock //be called when the socket disconnect

- (void)onSocketDidSecure:(AsyncSocket *)sock // be called when TLS is unstable
</pre>
<p><strong>Example client</strong></p>
<pre lang="objective-c">
AsyncSocket *client;
NSSError *err=nil;
NSString *hel=@"hello AsyncSocket!"; 
NSData *data = [hel dataUsingEncoding:NSISOLatin1StringEncoding];
[client connectToHost:@"127.0.0.1" onPort:51423 error:&err];
[client writeData:data withTimeout:-1 tag:0];
- (void)onSocket:(AsyncSocket *)sock didReadData:(NSData *)data withTag:(long)tag{  
    
    NSString* aStr = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];  
    NSLog(@"Hava received datas is :%@",aStr);  
    [aStr release];  
    [client readDataWithTimeout:-1 tag:0];  
} 
</pre>
<p><strong>Example server</strong></p>
<pre lang="python">
import socket
host=''
port=51423
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)
s.bind((host,port))
s.listen(1)

print "server is running on port %d;press ctrl-c to terminate"
while 1:
    try:
        clientsock, clientaddr = s.accept()
    except KeyboardInterrupt:
        raise
    except:
        traceback.print_exc()
        continue
    try:
        print "Got connection from", clientsock.getpeername()
        while 1:
            data = clientsock.recv(4096)
            if not len(data):
                break
            clientsock.sendall(data)
    except (KeyboardInterrupt, SystemExit):
        raise
    except:
        traceback.print_exc()
    try:
        clientsock.close()
    except KeyboardInterrupt:
        raise
    except:
        traceback.print_exc()

</pre>
