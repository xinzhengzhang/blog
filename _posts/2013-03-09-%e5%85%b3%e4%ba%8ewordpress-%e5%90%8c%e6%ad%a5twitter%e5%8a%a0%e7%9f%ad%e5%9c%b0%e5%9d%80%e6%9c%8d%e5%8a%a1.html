---
layout: post
title: 关于wordpress 同步twitter加短地址服务
categories:
- program
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _social_broadcast_content: 'a:1:{s:7:"twitter";a:1:{i:334092962;s:125:"关于wordpress
    同步twitter加短地址服务: 1.首先安装依赖http://wordpress.org/extend/plugi... http://t.cn/zYmW8Sk";}}'
  _sinaweibo_sync: 'true'
  _sinaweibo_sync_id: '3554006721089291'
  _social_notify: '1'
  _social_broadcast_meta: a:1:{s:7:"twitter";a:1:{i:334092962;a:0:{}}}
  _social_broadcasted_ids: a:1:{s:7:"twitter";a:1:{i:334092962;a:1:{i:310335447404535808;a:3:{s:7:"message";s:3336:"eyJlbnRpdGllcyI6eyJ1c2VyX21lbnRpb25zIjpbXSwidXJscyI6W3siZGlzcGxheV91cmwiOiJ3b3JkcHJlc3Mub3JnXC9leHRlbmRcL3BsdWdpIiwiZXhwYW5kZWRfdXJsIjoiaHR0cDpcL1wvd29yZHByZXNzLm9yZ1wvZXh0ZW5kXC9wbHVnaSIsImluZGljZXMiOlszNyw1OV0sInVybCI6Imh0dHA6XC9cL3QuY29cL1ZDWkhUdEcyWlYifSx7ImRpc3BsYXlfdXJsIjoidC5jblwvelltVzhTayIsImV4cGFuZGVkX3VybCI6Imh0dHA6XC9cL3QuY25cL3pZbVc4U2siLCJpbmRpY2VzIjpbNjMsODVdLCJ1cmwiOiJodHRwOlwvXC90LmNvXC80QTZQUkFtbkRTIn1dLCJoYXNodGFncyI6W119LCJ1c2VyIjp7ImlkIjoiMzM0MDkyOTYyIiwicHJvZmlsZV9zaWRlYmFyX2ZpbGxfY29sb3IiOiJEREVFRjYiLCJlbnRpdGllcyI6eyJ1cmwiOnsidXJscyI6W3siZGlzcGxheV91cmwiOiJzbm9ybGF4LnNpbmFhcHAuY29tIiwiZXhwYW5kZWRfdXJsIjoiaHR0cDpcL1wvc25vcmxheC5zaW5hYXBwLmNvbSIsImluZGljZXMiOlswLDIyXSwidXJsIjoiaHR0cDpcL1wvdC5jb1wvSGxOWDlKZ1RmTiJ9XX0sImRlc2NyaXB0aW9uIjp7InVybHMiOltdfX0sImxvY2F0aW9uIjpudWxsLCJpc190cmFuc2xhdG9yIjpmYWxzZSwiZGVmYXVsdF9wcm9maWxlIjp0cnVlLCJmb2xsb3dlcnNfY291bnQiOjEwLCJwcm9maWxlX2JhY2tncm91bmRfY29sb3IiOiJDMERFRUQiLCJ2ZXJpZmllZCI6ZmFsc2UsInV0Y19vZmZzZXQiOjI4ODAwLCJuYW1lIjoic25vcmxheHp4eiIsImxhbmciOiJ6aC1jbiIsImxpc3RlZF9jb3VudCI6MSwicHJvZmlsZV9iYWNrZ3JvdW5kX2ltYWdlX3VybF9odHRwcyI6Imh0dHBzOlwvXC9zaTAudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUxXC9iZy5wbmciLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTAudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUxXC9iZy5wbmciLCJwcm90ZWN0ZWQiOmZhbHNlLCJwcm9maWxlX2xpbmtfY29sb3IiOiIwMDg0QjQiLCJzdGF0dXNlc19jb3VudCI6MTcsImNvbnRyaWJ1dG9yc19lbmFibGVkIjpmYWxzZSwidGltZV96b25lIjoiQmVpamluZyIsInByb2ZpbGVfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTAudHdpbWcuY29tXC9wcm9maWxlX2ltYWdlc1wvMzM1MjM5MDY1OVwvOTczYmUxOTQ4OWRmYzMzOTdjYmU5ZTI1NjJhMDFjZTNfbm9ybWFsLmpwZWciLCJwcm9maWxlX2ltYWdlX3VybF9odHRwcyI6Imh0dHBzOlwvXC9zaTAudHdpbWcuY29tXC9wcm9maWxlX2ltYWdlc1wvMzM1MjM5MDY1OVwvOTczYmUxOTQ4OWRmYzMzOTdjYmU5ZTI1NjJhMDFjZTNfbm9ybWFsLmpwZWciLCJjcmVhdGVkX2F0IjoiVHVlIEp1bCAxMiAxNToyODo0MCArMDAwMCAyMDExIiwicHJvZmlsZV91c2VfYmFja2dyb3VuZF9pbWFnZSI6dHJ1ZSwiZm9sbG93aW5nIjpmYWxzZSwicHJvZmlsZV90ZXh0X2NvbG9yIjoiMzMzMzMzIiwiZ2VvX2VuYWJsZWQiOnRydWUsImlkX3N0ciI6IjMzNDA5Mjk2MiIsImRlZmF1bHRfcHJvZmlsZV9pbWFnZSI6ZmFsc2UsInVybCI6Imh0dHA6XC9cL3QuY29cL0hsTlg5SmdUZk4iLCJwcm9maWxlX3NpZGViYXJfYm9yZGVyX2NvbG9yIjoiQzBERUVEIiwiZmF2b3VyaXRlc19jb3VudCI6MCwiZnJpZW5kc19jb3VudCI6MTAwLCJmb2xsb3dfcmVxdWVzdF9zZW50IjpmYWxzZSwic2NyZWVuX25hbWUiOiJaaGFuZ1hpblpoZW5nIiwibm90aWZpY2F0aW9ucyI6ZmFsc2UsImRlc2NyaXB0aW9uIjoiYWNnXFxweXRob25cXGlvcyIsInByb2ZpbGVfYmFja2dyb3VuZF90aWxlIjpmYWxzZX0sInBsYWNlIjpudWxsLCJyZXR3ZWV0X2NvdW50IjowLCJpbl9yZXBseV90b19zdGF0dXNfaWQiOm51bGwsInBvc3NpYmx5X3NlbnNpdGl2ZSI6ZmFsc2UsImNyZWF0ZWRfYXQiOiJTYXQgTWFyIDA5IDEwOjI1OjExICswMDAwIDIwMTMiLCJjb250cmlidXRvcnMiOm51bGwsImluX3JlcGx5X3RvX3NjcmVlbl9uYW1lIjpudWxsLCJmYXZvcml0ZWQiOmZhbHNlLCJnZW8iOm51bGwsImluX3JlcGx5X3RvX3N0YXR1c19pZF9zdHIiOm51bGwsImNvb3JkaW5hdGVzIjpudWxsLCJ0cnVuY2F0ZWQiOmZhbHNlLCJ0ZXh0IjoiXHU1MTczXHU0ZThld29yZHByZXNzIFx1NTQwY1x1NmI2NXR3aXR0ZXJcdTUyYTBcdTc3ZWRcdTU3MzBcdTU3NDBcdTY3MGRcdTUyYTE6IDEuXHU5OTk2XHU1MTQ4XHU1Yjg5XHU4OGM1XHU0ZjlkXHU4ZDU2aHR0cDpcL1wvdC5jb1wvVkNaSFR0RzJaVi4uLiBodHRwOlwvXC90LmNvXC80QTZQUkFtbkRTIiwiaWRfc3RyIjoiMzEwMzM1NDQ3NDA0NTM1ODA4Iiwic291cmNlIjoiPGEgaHJlZj1cImh0dHBzOlwvXC9zb3ByZXN0by5tYWlsY2hpbXAuY29tXCIgcmVsPVwibm9mb2xsb3dcIj5Tb2NpYWwgUHJveHkgYnkgTWFpbGNoaW1wPFwvYT4iLCJpbl9yZXBseV90b191c2VyX2lkX3N0ciI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZCI6bnVsbCwiaWQiOiIzMTAzMzU0NDc0MDQ1MzU4MDgiLCJyZXR3ZWV0ZWQiOmZhbHNlfQ==";s:4:"urls";a:2:{i:0;s:33:"http://snorlax.sinaapp.com/?p=287";i:1;s:0:"";}s:7:"account";O:8:"stdClass":1:{s:4:"user";O:8:"stdClass":38:{s:2:"id";s:9:"334092962";s:6:"id_str";s:9:"334092962";s:4:"name";s:10:"snorlaxzxz";s:11:"screen_name";s:13:"ZhangXinZheng";s:8:"location";s:0:"";s:3:"url";s:26:"http://snorlax.sinaapp.com";s:11:"description";s:12:"acgpythonios";s:9:"protected";s:1:"0";s:15:"followers_count";s:2:"10";s:13:"friends_count";s:3:"100";s:12:"listed_count";s:1:"1";s:10:"created_at";s:30:"Tue
    Jul 12 15:28:40 +0000 2011";s:16:"favourites_count";s:1:"0";s:10:"utc_offset";s:5:"28800";s:9:"time_zone";s:7:"Beijing";s:11:"geo_enabled";s:1:"1";s:8:"verified";s:1:"0";s:14:"statuses_count";s:2:"14";s:4:"lang";s:5:"zh-cn";s:6:"status";a:11:{s:10:"created_at";s:30:"Fri
    Mar 08 07:59:58 +0000 2013";s:2:"id";s:18:"309936517424484352";s:6:"id_str";s:18:"309936517424484352";s:4:"text";s:88:"关于编写高性能服务器的资料汇总(Linux)
    | Ace's Blog http://t.co/CIFIvJkrru";s:6:"source";s:12:"Tweet Button";s:9:"truncated";s:1:"0";s:13:"retweet_count";s:1:"0";s:9:"favorited";s:1:"0";s:9:"retweeted";s:1:"0";s:18:"possibly_sensitive";s:1:"0";s:4:"lang";s:2:"zh";}s:20:"contributors_enabled";s:1:"0";s:13:"is_translator";s:1:"0";s:24:"profile_background_color";s:6:"C0DEED";s:28:"profile_background_image_url";s:47:"http://a0.twimg.com/images/themes/theme1/bg.png";s:34:"profile_background_image_url_https";s:49:"https://si0.twimg.com/images/themes/theme1/bg.png";s:23:"profile_background_tile";s:1:"0";s:17:"profile_image_url";s:90:"http://a0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:23:"profile_image_url_https";s:92:"https://si0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:18:"profile_link_color";s:6:"0084B4";s:28:"profile_sidebar_border_color";s:6:"C0DEED";s:26:"profile_sidebar_fill_color";s:6:"DDEEF6";s:18:"profile_text_color";s:6:"333333";s:28:"profile_use_background_image";s:1:"1";s:15:"default_profile";s:1:"1";s:21:"default_profile_image";s:1:"0";s:9:"following";s:1:"0";s:19:"follow_request_sent";s:1:"0";s:13:"notifications";s:1:"0";}}}}}}
  _social_aggregated_ids: a:2:{s:7:"twitter";a:0:{}s:8:"facebook";a:0:{}}
  _social_aggregation_log: a:10:{i:1362826453;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362828559;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362831341;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362836345;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362844645;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362861755;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362891546;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1362935430;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1363022313;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1363196716;O:8:"stdClass":1:{s:6:"manual";s:0:"";}}
  views: '5'
author:
  login: snorlax
  email: zhangxzheng@hotmail.com
  display_name: snorlax
  first_name: ''
  last_name: ''
---
<p>1.首先安装依赖http://wordpress.org/extend/plugins/social/<br />
2.再安装上 https://wordpress.org/extend/plugins/twitter-tools/</p>
<p>这样就其实已经可以在发布的时候同步到twitter上了、但是有一个问题那就是url是全长度输出的、在限制长度的twitter下这是个非常大的问题<br />
所以我修改了下源码用了sina的短地址服务（大sina把google api给墙掉了残年……<br />
-----------------------------------------------------------------------------------------------------------<br />
具体操作如下<br />
1.首先从wordpress的根目录开始寻址到/wp-content/plugins/social/views/wp-admin/post/broadcast/options.php （我们需要修改文件就在这<br />
2.找到第70行 其实我们从这里就可以看出$account['content']里就是我们发出的文本段（鉴于本人太懒不高兴往上找了所以就直接在这段做处理<br />
3.先用正则式剔出我们blog的url 然后对他进行shorten再替换回去</p>
<pre lang='php'>
<?php
    preg_match("#http\://snorlax\.sinaapp\.com/\?p\=\d+#",$account['content'],$matches);
    $apiKey='3818214747';
    //调用sina的api 注:这个api在文档显示正在走向废弃的道路所以随时有可能挂也说不定= =
    //具体调用方法参考http://open.weibo.com/wiki/Short_url/shorten
    $apiUrl='http://api.t.sina.com.cn/short_url/shorten.json?source='.$apiKey.'&url_long='.$matches[0];
    $response = file_get_contents($apiUrl);
    $json = json_decode($response);
    $tar=str_replace($matches[0],$json[0]->url_short,$account['content']);
    echo esc_textarea($tar);
	echo "</textarea><p class=\"readonly\">; 
	echo esc_textarea($tar); 
?>
</pre>
<p>然后跑起来就ok了<br />
修改完后的文件附上:<a href='http://snorlax-wordpress.stor.sinaapp.com/uploads/2013/03/options.php_.zip'>options.php</a></p>
