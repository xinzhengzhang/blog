---
layout: post
title: 定制 UIPageControl
categories:
- program
tags: []
status: publish
type: post
published: true
meta:
  _social_aggregated_ids: a:2:{s:7:"twitter";a:0:{}s:8:"facebook";a:0:{}}
  _edit_last: '1'
  _social_aggregation_log: a:35:{i:1372059722;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372060946;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372062153;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372064915;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372069027;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372071867;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372073942;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372081201;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372085517;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372086360;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372090293;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372090672;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372101038;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372106197;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372108836;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372109706;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372116392;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372125760;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372131557;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372135965;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372141357;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372144706;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372148771;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372151161;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372151807;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372152040;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372161325;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372186313;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372225563;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372270619;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372360978;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372366140;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372372379;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372373449;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1372548966;O:8:"stdClass":1:{s:6:"manual";s:0:"";}}
  _social_broadcasted_ids: a:1:{s:7:"twitter";a:1:{i:334092962;a:1:{i:349064536017473536;a:3:{s:7:"message";s:3160:"eyJpbl9yZXBseV90b19zdGF0dXNfaWQiOm51bGwsInVzZXIiOnsibmFtZSI6InNub3JsYXh6eHoiLCJwcm9maWxlX2JhY2tncm91bmRfY29sb3IiOiJDMERFRUQiLCJsYW5nIjoiemgtY24iLCJwcm9maWxlX2ltYWdlX3VybF9odHRwcyI6Imh0dHBzOlwvXC9zaTAudHdpbWcuY29tXC9wcm9maWxlX2ltYWdlc1wvMzM1MjM5MDY1OVwvOTczYmUxOTQ4OWRmYzMzOTdjYmU5ZTI1NjJhMDFjZTNfbm9ybWFsLmpwZWciLCJzY3JlZW5fbmFtZSI6IlpoYW5nWGluWmhlbmciLCJpZCI6IjMzNDA5Mjk2MiIsInByb2ZpbGVfYmFja2dyb3VuZF9pbWFnZV91cmwiOiJodHRwOlwvXC9hMC50d2ltZy5jb21cL2ltYWdlc1wvdGhlbWVzXC90aGVtZTFcL2JnLnBuZyIsInZlcmlmaWVkIjpmYWxzZSwiZGVmYXVsdF9wcm9maWxlIjp0cnVlLCJub3RpZmljYXRpb25zIjpmYWxzZSwicHJvZmlsZV9saW5rX2NvbG9yIjoiMDA4NEI0Iiwic3RhdHVzZXNfY291bnQiOjYzLCJjb250cmlidXRvcnNfZW5hYmxlZCI6ZmFsc2UsImlkX3N0ciI6IjMzNDA5Mjk2MiIsImlzX3RyYW5zbGF0b3IiOmZhbHNlLCJwcm9maWxlX3VzZV9iYWNrZ3JvdW5kX2ltYWdlIjp0cnVlLCJmb2xsb3dpbmciOmZhbHNlLCJ1dGNfb2Zmc2V0IjoyODgwMCwicHJvZmlsZV90ZXh0X2NvbG9yIjoiMzMzMzMzIiwiY3JlYXRlZF9hdCI6IlR1ZSBKdWwgMTIgMTU6Mjg6NDAgKzAwMDAgMjAxMSIsImxpc3RlZF9jb3VudCI6MSwicHJvZmlsZV9pbWFnZV91cmwiOiJodHRwOlwvXC9hMC50d2ltZy5jb21cL3Byb2ZpbGVfaW1hZ2VzXC8zMzUyMzkwNjU5XC85NzNiZTE5NDg5ZGZjMzM5N2NiZTllMjU2MmEwMWNlM19ub3JtYWwuanBlZyIsInByb2ZpbGVfYmFja2dyb3VuZF9pbWFnZV91cmxfaHR0cHMiOiJodHRwczpcL1wvc2kwLnR3aW1nLmNvbVwvaW1hZ2VzXC90aGVtZXNcL3RoZW1lMVwvYmcucG5nIiwidGltZV96b25lIjoiQmVpamluZyIsImZvbGxvd19yZXF1ZXN0X3NlbnQiOmZhbHNlLCJwcm90ZWN0ZWQiOmZhbHNlLCJwcm9maWxlX3NpZGViYXJfYm9yZGVyX2NvbG9yIjoiQzBERUVEIiwiZGVzY3JpcHRpb24iOiJhY2dcXHB5dGhvblxcaW9zIiwiZnJpZW5kc19jb3VudCI6MTE2LCJmb2xsb3dlcnNfY291bnQiOjEwLCJwcm9maWxlX2JhY2tncm91bmRfdGlsZSI6ZmFsc2UsImRlZmF1bHRfcHJvZmlsZV9pbWFnZSI6ZmFsc2UsInByb2ZpbGVfc2lkZWJhcl9maWxsX2NvbG9yIjoiRERFRUY2IiwidXJsIjoiaHR0cDpcL1wvdC5jb1wvSGxOWDlKZ1RmTiIsImVudGl0aWVzIjp7InVybCI6eyJ1cmxzIjpbeyJleHBhbmRlZF91cmwiOiJodHRwOlwvXC9zbm9ybGF4LnNpbmFhcHAuY29tIiwidXJsIjoiaHR0cDpcL1wvdC5jb1wvSGxOWDlKZ1RmTiIsImluZGljZXMiOlswLDIyXSwiZGlzcGxheV91cmwiOiJzbm9ybGF4LnNpbmFhcHAuY29tIn1dfSwiZGVzY3JpcHRpb24iOnsidXJscyI6W119fSwiZmF2b3VyaXRlc19jb3VudCI6MCwiZ2VvX2VuYWJsZWQiOnRydWUsImxvY2F0aW9uIjpudWxsfSwiaW5fcmVwbHlfdG9fc2NyZWVuX25hbWUiOm51bGwsImlkX3N0ciI6IjM0OTA2NDUzNjAxNzQ3MzUzNiIsImNvbnRyaWJ1dG9ycyI6bnVsbCwiZ2VvIjpudWxsLCJjcmVhdGVkX2F0IjoiTW9uIEp1biAyNCAwNzoyMDo0NSArMDAwMCAyMDEzIiwicG9zc2libHlfc2Vuc2l0aXZlIjpmYWxzZSwiZmF2b3JpdGVkIjpmYWxzZSwidHJ1bmNhdGVkIjpmYWxzZSwic291cmNlIjoiPGEgaHJlZj1cImh0dHBzOlwvXC9zb3ByZXN0by5tYWlsY2hpbXAuY29tXCIgcmVsPVwibm9mb2xsb3dcIj5Tb2NpYWwgUHJveHkgYnkgTWFpbGNoaW1wPFwvYT4iLCJlbnRpdGllcyI6eyJ1c2VyX21lbnRpb25zIjpbXSwiaGFzaHRhZ3MiOltdLCJ1cmxzIjpbeyJleHBhbmRlZF91cmwiOiJodHRwOlwvXC90LmNuXC96SGd0WlZwIiwidXJsIjoiaHR0cDpcL1wvdC5jb1wvcFdzUUNqVVZDWCIsImluZGljZXMiOls2OCw5MF0sImRpc3BsYXlfdXJsIjoidC5jblwvekhndFpWcCJ9XX0sInBsYWNlIjpudWxsLCJpZCI6IjM0OTA2NDUzNjAxNzQ3MzUzNiIsImNvb3JkaW5hdGVzIjpudWxsLCJpbl9yZXBseV90b191c2VyX2lkIjpudWxsLCJyZXR3ZWV0X2NvdW50IjowLCJpbl9yZXBseV90b19zdGF0dXNfaWRfc3RyIjpudWxsLCJ0ZXh0IjoiXHU1YjlhXHU1MjM2IFVJUGFnZUNvbnRyb2w6IHBhZ2Vjb250cm9sIFx1NWMzMVx1NjYyZmlwaG9uZVx1NGUwYVx1OTc2Mlx1NmJkNFx1NTk4MnNjcm9sbHZpZXdcdTdmZmJcdTU2ZmVcdTcyNDdcdTY1ZjZcdTUwMTlcdTRlMGJcdTk3NjJcdTkwYTNcdTRlMmFcdTVjMGZcdTcwYjlcdWZmZmQuLi4gaHR0cDpcL1wvdC5jb1wvcFdzUUNqVVZDWCIsInJldHdlZXRlZCI6ZmFsc2UsImluX3JlcGx5X3RvX3VzZXJfaWRfc3RyIjpudWxsfQ==";s:4:"urls";a:2:{i:0;s:33:"http://snorlax.sinaapp.com/?p=383";i:1;s:0:"";}s:7:"account";O:8:"stdClass":1:{s:4:"user";O:8:"stdClass":38:{s:2:"id";s:9:"334092962";s:6:"id_str";s:9:"334092962";s:4:"name";s:10:"snorlaxzxz";s:11:"screen_name";s:13:"ZhangXinZheng";s:8:"location";s:0:"";s:3:"url";s:26:"http://snorlax.sinaapp.com";s:11:"description";s:12:"acgpythonios";s:9:"protected";s:1:"0";s:15:"followers_count";s:2:"10";s:13:"friends_count";s:3:"100";s:12:"listed_count";s:1:"1";s:10:"created_at";s:30:"Tue
    Jul 12 15:28:40 +0000 2011";s:16:"favourites_count";s:1:"0";s:10:"utc_offset";s:5:"28800";s:9:"time_zone";s:7:"Beijing";s:11:"geo_enabled";s:1:"1";s:8:"verified";s:1:"0";s:14:"statuses_count";s:2:"14";s:4:"lang";s:5:"zh-cn";s:6:"status";a:11:{s:10:"created_at";s:30:"Fri
    Mar 08 07:59:58 +0000 2013";s:2:"id";s:18:"309936517424484352";s:6:"id_str";s:18:"309936517424484352";s:4:"text";s:88:"关于编写高性能服务器的资料汇总(Linux)
    | Ace's Blog http://t.co/CIFIvJkrru";s:6:"source";s:12:"Tweet Button";s:9:"truncated";s:1:"0";s:13:"retweet_count";s:1:"0";s:9:"favorited";s:1:"0";s:9:"retweeted";s:1:"0";s:18:"possibly_sensitive";s:1:"0";s:4:"lang";s:2:"zh";}s:20:"contributors_enabled";s:1:"0";s:13:"is_translator";s:1:"0";s:24:"profile_background_color";s:6:"C0DEED";s:28:"profile_background_image_url";s:47:"http://a0.twimg.com/images/themes/theme1/bg.png";s:34:"profile_background_image_url_https";s:49:"https://si0.twimg.com/images/themes/theme1/bg.png";s:23:"profile_background_tile";s:1:"0";s:17:"profile_image_url";s:90:"http://a0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:23:"profile_image_url_https";s:92:"https://si0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:18:"profile_link_color";s:6:"0084B4";s:28:"profile_sidebar_border_color";s:6:"C0DEED";s:26:"profile_sidebar_fill_color";s:6:"DDEEF6";s:18:"profile_text_color";s:6:"333333";s:28:"profile_use_background_image";s:1:"1";s:15:"default_profile";s:1:"1";s:21:"default_profile_image";s:1:"0";s:9:"following";s:1:"0";s:19:"follow_request_sent";s:1:"0";s:13:"notifications";s:1:"0";}}}}}}
  _social_broadcast_meta: a:1:{s:7:"twitter";a:1:{i:334092962;a:0:{}}}
  _social_broadcast_content: 'a:1:{s:7:"twitter";a:1:{i:334092962;s:127:"定制 UIPageControl:
    pagecontrol 就是iphone上面比如scrollview翻图片时候下面那个小点�... http://t.cn/zHgtZVp";}}'
  _sinaweibo_sync_id: '3592735808698956'
  _social_notify: '1'
  _sinaweibo_sync: 'true'
author:
  login: snorlax
  email: zhangxzheng@hotmail.com
  display_name: snorlax
  first_name: ''
  last_name: ''
---
<p>pagecontrol 就是iphone上面比如scrollview翻图片时候下面那个小点点<br />
其实我个人觉得还是挺美观的……可是需求就是要自己的图片替掉……然后死人苹果又不给api、所以也就只能自己复写实现了<br />
先说下ios7之前 那些点点的实现非常简单 就是UIPageControl.subviews 就是一个个点的UIImageView 所以只需简单的替换掉就好了代码如下</p>
<pre lang="c">
@property(nonatomic,strong)UIImage *_activeImage;
@property(nonatomic,strong)UIImage *_inactiveImage;
//在init的时候把你自己定义的两张图片搞进去
- (void)updateDots
{
    for (int i = 0; i< [self.subviews count]; i++) {
        UIImageView* dot =[self.subviews objectAtIndex:i];

        if (i == self.currentPage) {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_activeImage;
            }

        } else {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_inactiveImage;
            }
        }
    }
}
//然后自己重载一下setNumber就好了

- (void)setNumberOfPages:(NSInteger)numberOfPages
{
    [super setNumberOfPages:numberOfPages];
    [self updateDots];
}
</pre>
<p>但是呢万恶的ios7改掉了尼玛……连底层实现都改啊混蛋……可以对self.subviews 标红一下就明白了……整个pagecontrol的uivew乱七八糟……而且都是view根本就没了image属性、换句话说现在的那些小点点都是代码写出来的了、而不是简单图了<br />
实现起来就要重写UIView的绘画函数了代码大致如下</p>
<pre lang="c">
#import "ZDPageControll.h"
#import <QuartzCore/QuartzCore.h>

@interface ZDPageControll()
{
    UIImage *_activeImage;
    UIImage *_inactiveImage;
    NSArray *_usedToRetainOriginalSubview;
}

@end

@implementation ZDPageControll
@synthesize kSpacing=_kSpacing;
- (id)initWithFrame:(CGRect)frame currentImageName:(NSString *)current commonImageName:(NSString *)common
{
    self= [super initWithFrame:frame];
    if ([self respondsToSelector:@selector(setCurrentPageIndicatorTintColor:)] && [self respondsToSelector:@selector(setPageIndicatorTintColor:)]) {
        [self setCurrentPageIndicatorTintColor:[UIColor clearColor]];
        [self setPageIndicatorTintColor:[UIColor clearColor]];
    }
    
    [self setBackgroundColor:[UIColor clearColor]];
    _activeImage= [UIImage imageNamed:current];
    _inactiveImage= [UIImage imageNamed:common];
    _kSpacing=10.0f;
    //hold住原来pagecontroll的subview
    _usedToRetainOriginalSubview=[NSArray arrayWithArray:self.subviews];
    for (UIView *su in self.subviews) {
        [su removeFromSuperview];
    }
    self.contentMode=UIViewContentModeRedraw;
    return self;
}
-(void)dealloc
{
    //释放原来hold住的那些subview
    _usedToRetainOriginalSubview=nil;
    _activeImage=nil;
    _inactiveImage=nil;
}
- (void)updateDots
{

    for (int i = 0; i< [self.subviews count]; i++) {
        UIImageView* dot =[self.subviews objectAtIndex:i];

        if (i == self.currentPage) {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_activeImage;
            }

        } else {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_inactiveImage;
            }
        }
    }

}

- (void)setCurrentPage:(NSInteger)currentPage
{
    [super setCurrentPage:currentPage];
    if ([[[UIDevice currentDevice]systemVersion]floatValue] <=6.0) {
        [self updateDots];
    }
//    [self updateDots];
    [self setNeedsDisplay];
}
- (void)setNumberOfPages:(NSInteger)numberOfPages
{
    [super setNumberOfPages:numberOfPages];
    if ([[[UIDevice currentDevice]systemVersion]floatValue] <=6.0) {
        [self updateDots];
    }
//    [self updateDots];
    [self setNeedsDisplay];

}
-(void)drawRect:(CGRect)iRect
{
    int i;
    CGRect rect;
    
    UIImage *image;
    iRect = self.bounds;
    
    if ( self.opaque ) {
        [self.backgroundColor set];
        UIRectFill( iRect );
    }
    
    if ( self.hidesForSinglePage && self.numberOfPages == 1 ) return;
    
    rect.size.height = _activeImage.size.height;
    rect.size.width = self.numberOfPages * _activeImage.size.width + ( self.numberOfPages - 1 ) * _kSpacing;
    rect.origin.x = floorf( ( iRect.size.width - rect.size.width ) / 2.0 );
    rect.origin.y = floorf( ( iRect.size.height - rect.size.height ) / 2.0 );
    rect.size.width = _activeImage.size.width;
    
    for ( i = 0; i < self.numberOfPages; ++i ) {
        image = i == self.currentPage ? _activeImage : _inactiveImage;
        
        [image drawInRect: rect];
        
        rect.origin.x += _activeImage.size.width + _kSpacing;
    }
}
@end

</pre>
