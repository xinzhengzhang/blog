---
layout: post
title: ios替换系统方法
categories:
- program
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _social_broadcast_content: 'a:1:{s:7:"twitter";a:1:{i:334092962;s:129:"ios替换系统方法:
    作为动态语言的oc我以前一直忽视了他的动态特性最近一个��... http://t.cn/zQJoDkO";}}'
  _sinaweibo_sync: 'true'
  _sinaweibo_sync_id: '3605357207401362'
  _social_notify: '1'
  _social_broadcast_meta: a:1:{s:7:"twitter";a:1:{i:334092962;a:0:{}}}
  _social_aggregated_ids: a:2:{s:7:"twitter";a:0:{}s:8:"facebook";a:0:{}}
  _social_aggregation_log: a:10:{i:1375068644;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375071597;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375074313;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375078647;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375087541;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375104760;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375134267;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375177545;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375267876;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1375441271;O:8:"stdClass":1:{s:6:"manual";s:0:"";}}
  _social_broadcasted_ids: a:1:{s:7:"twitter";a:1:{i:334092962;a:1:{i:361685937647910912;a:3:{s:7:"message";s:3212:"eyJwb3NzaWJseV9zZW5zaXRpdmUiOmZhbHNlLCJ1c2VyIjp7ImRlZmF1bHRfcHJvZmlsZSI6dHJ1ZSwic2NyZWVuX25hbWUiOiJaaGFuZ1hpblpoZW5nIiwibmFtZSI6InNub3JsYXh6eHoiLCJmb2xsb3dpbmciOmZhbHNlLCJjcmVhdGVkX2F0IjoiVHVlIEp1bCAxMiAxNToyODo0MCArMDAwMCAyMDExIiwicHJvZmlsZV9zaWRlYmFyX2JvcmRlcl9jb2xvciI6IkMwREVFRCIsIm5vdGlmaWNhdGlvbnMiOmZhbHNlLCJpZCI6IjMzNDA5Mjk2MiIsImxpc3RlZF9jb3VudCI6MiwicHJvZmlsZV9iYWNrZ3JvdW5kX3RpbGUiOmZhbHNlLCJnZW9fZW5hYmxlZCI6dHJ1ZSwic3RhdHVzZXNfY291bnQiOjY3LCJwcm9maWxlX3NpZGViYXJfZmlsbF9jb2xvciI6IkRERUVGNiIsInByb2ZpbGVfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTAudHdpbWcuY29tXC9wcm9maWxlX2ltYWdlc1wvMzM1MjM5MDY1OVwvOTczYmUxOTQ4OWRmYzMzOTdjYmU5ZTI1NjJhMDFjZTNfbm9ybWFsLmpwZWciLCJlbnRpdGllcyI6eyJ1cmwiOnsidXJscyI6W3siZGlzcGxheV91cmwiOiJzbm9ybGF4LnNpbmFhcHAuY29tIiwiZXhwYW5kZWRfdXJsIjoiaHR0cDpcL1wvc25vcmxheC5zaW5hYXBwLmNvbSIsImluZGljZXMiOlswLDIyXSwidXJsIjoiaHR0cDpcL1wvdC5jb1wvSGxOWDlKZ1RmTiJ9XX0sImRlc2NyaXB0aW9uIjp7InVybHMiOltdfX0sInVybCI6Imh0dHA6XC9cL3QuY29cL0hsTlg5SmdUZk4iLCJ1dGNfb2Zmc2V0IjoyODgwMCwiZm9sbG93ZXJzX2NvdW50IjoxMCwicHJvZmlsZV9iYWNrZ3JvdW5kX2NvbG9yIjoiQzBERUVEIiwicHJvZmlsZV9iYWNrZ3JvdW5kX2ltYWdlX3VybF9odHRwcyI6Imh0dHBzOlwvXC9zaTAudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUxXC9iZy5wbmciLCJkZWZhdWx0X3Byb2ZpbGVfaW1hZ2UiOmZhbHNlLCJsb2NhdGlvbiI6bnVsbCwiZmF2b3VyaXRlc19jb3VudCI6MCwicHJvdGVjdGVkIjpmYWxzZSwiZGVzY3JpcHRpb24iOiJhY2dcXHB5dGhvblxcaW9zIiwiY29udHJpYnV0b3JzX2VuYWJsZWQiOmZhbHNlLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTAudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUxXC9iZy5wbmciLCJsYW5nIjoiemgtY24iLCJmcmllbmRzX2NvdW50IjoxMTYsInByb2ZpbGVfbGlua19jb2xvciI6IjAwODRCNCIsImlzX3RyYW5zbGF0b3IiOmZhbHNlLCJpZF9zdHIiOiIzMzQwOTI5NjIiLCJwcm9maWxlX3VzZV9iYWNrZ3JvdW5kX2ltYWdlIjp0cnVlLCJwcm9maWxlX3RleHRfY29sb3IiOiIzMzMzMzMiLCJ0aW1lX3pvbmUiOiJCZWlqaW5nIiwiZm9sbG93X3JlcXVlc3Rfc2VudCI6ZmFsc2UsInZlcmlmaWVkIjpmYWxzZSwicHJvZmlsZV9pbWFnZV91cmxfaHR0cHMiOiJodHRwczpcL1wvc2kwLnR3aW1nLmNvbVwvcHJvZmlsZV9pbWFnZXNcLzMzNTIzOTA2NTlcLzk3M2JlMTk0ODlkZmMzMzk3Y2JlOWUyNTYyYTAxY2UzX25vcm1hbC5qcGVnIn0sImluX3JlcGx5X3RvX3N0YXR1c19pZCI6bnVsbCwidHJ1bmNhdGVkIjpmYWxzZSwiaW5fcmVwbHlfdG9fc2NyZWVuX25hbWUiOm51bGwsInNvdXJjZSI6IjxhIGhyZWY9XCJodHRwczpcL1wvc29wcmVzdG8ubWFpbGNoaW1wLmNvbVwiIHJlbD1cIm5vZm9sbG93XCI+U29jaWFsIFByb3h5IGJ5IE1haWxjaGltcDxcL2E+IiwiZ2VvIjpudWxsLCJmYXZvcml0ZWQiOmZhbHNlLCJpbl9yZXBseV90b19zdGF0dXNfaWRfc3RyIjpudWxsLCJpZF9zdHIiOiIzNjE2ODU5Mzc2NDc5MTA5MTIiLCJpZCI6IjM2MTY4NTkzNzY0NzkxMDkxMiIsImNyZWF0ZWRfYXQiOiJNb24gSnVsIDI5IDAzOjEzOjQxICswMDAwIDIwMTMiLCJpbl9yZXBseV90b191c2VyX2lkX3N0ciI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZCI6bnVsbCwiZW50aXRpZXMiOnsidXNlcl9tZW50aW9ucyI6W10sImhhc2h0YWdzIjpbXSwidXJscyI6W3siZGlzcGxheV91cmwiOiJ0LmNuXC96UUpvRGtPIiwiZXhwYW5kZWRfdXJsIjoiaHR0cDpcL1wvdC5jblwvelFKb0RrTyIsImluZGljZXMiOls0NCw2Nl0sInVybCI6Imh0dHA6XC9cL3QuY29cL2ZteEw2bVRsemkifV19LCJjb29yZGluYXRlcyI6bnVsbCwicmV0d2VldF9jb3VudCI6MCwidGV4dCI6Imlvc1x1NjZmZlx1NjM2Mlx1N2NmYlx1N2VkZlx1NjViOVx1NmNkNTogXHU0ZjVjXHU0ZTNhXHU1MmE4XHU2MDAxXHU4YmVkXHU4YTAwXHU3Njg0b2NcdTYyMTFcdTRlZTVcdTUyNGRcdTRlMDBcdTc2ZjRcdTVmZmRcdTg5YzZcdTRlODZcdTRlZDZcdTc2ODRcdTUyYThcdTYwMDFcdTcyNzlcdTYwMjdcdTY3MDBcdThmZDFcdTRlMDBcdTRlMmFcdWZmZmRcdWZmZmQuLi4gaHR0cDpcL1wvdC5jb1wvZm14TDZtVGx6aSIsInBsYWNlIjpudWxsLCJjb250cmlidXRvcnMiOm51bGwsInJldHdlZXRlZCI6ZmFsc2V9";s:4:"urls";a:2:{i:0;s:33:"http://snorlax.sinaapp.com/?p=393";i:1;s:0:"";}s:7:"account";O:8:"stdClass":1:{s:4:"user";O:8:"stdClass":38:{s:2:"id";s:9:"334092962";s:6:"id_str";s:9:"334092962";s:4:"name";s:10:"snorlaxzxz";s:11:"screen_name";s:13:"ZhangXinZheng";s:8:"location";s:0:"";s:3:"url";s:26:"http://snorlax.sinaapp.com";s:11:"description";s:12:"acgpythonios";s:9:"protected";s:1:"0";s:15:"followers_count";s:2:"10";s:13:"friends_count";s:3:"100";s:12:"listed_count";s:1:"1";s:10:"created_at";s:30:"Tue
    Jul 12 15:28:40 +0000 2011";s:16:"favourites_count";s:1:"0";s:10:"utc_offset";s:5:"28800";s:9:"time_zone";s:7:"Beijing";s:11:"geo_enabled";s:1:"1";s:8:"verified";s:1:"0";s:14:"statuses_count";s:2:"14";s:4:"lang";s:5:"zh-cn";s:6:"status";a:11:{s:10:"created_at";s:30:"Fri
    Mar 08 07:59:58 +0000 2013";s:2:"id";s:18:"309936517424484352";s:6:"id_str";s:18:"309936517424484352";s:4:"text";s:88:"关于编写高性能服务器的资料汇总(Linux)
    | Ace's Blog http://t.co/CIFIvJkrru";s:6:"source";s:12:"Tweet Button";s:9:"truncated";s:1:"0";s:13:"retweet_count";s:1:"0";s:9:"favorited";s:1:"0";s:9:"retweeted";s:1:"0";s:18:"possibly_sensitive";s:1:"0";s:4:"lang";s:2:"zh";}s:20:"contributors_enabled";s:1:"0";s:13:"is_translator";s:1:"0";s:24:"profile_background_color";s:6:"C0DEED";s:28:"profile_background_image_url";s:47:"http://a0.twimg.com/images/themes/theme1/bg.png";s:34:"profile_background_image_url_https";s:49:"https://si0.twimg.com/images/themes/theme1/bg.png";s:23:"profile_background_tile";s:1:"0";s:17:"profile_image_url";s:90:"http://a0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:23:"profile_image_url_https";s:92:"https://si0.twimg.com/profile_images/3352390659/973be19489dfc3397cbe9e2562a01ce3_normal.jpeg";s:18:"profile_link_color";s:6:"0084B4";s:28:"profile_sidebar_border_color";s:6:"C0DEED";s:26:"profile_sidebar_fill_color";s:6:"DDEEF6";s:18:"profile_text_color";s:6:"333333";s:28:"profile_use_background_image";s:1:"1";s:15:"default_profile";s:1:"1";s:21:"default_profile_image";s:1:"0";s:9:"following";s:1:"0";s:19:"follow_request_sent";s:1:"0";s:13:"notifications";s:1:"0";}}}}}}
author:
  login: snorlax
  email: zhangxzheng@hotmail.com
  display_name: snorlax
  first_name: ''
  last_name: ''
---
<p>作为动态语言的oc我以前一直忽视了他的动态特性最近一个分享会才突然就有种飘逸的感觉<br />
主要使用的就是oc的runtime特性<br />
#import "objc/runtime.h"<br />
引入这个头文件之后才发现动态远远不止我以前想的那么简单引入这个头文件后可以发现者真是海量的api能让代码写的真是自己都不认识都不过分<br />
然后就写一个例子来试验了<br />
比如 NSArray 里面的objetAtIndex 方法我想这个方法真是被无数人深恶痛绝……多少crash都是从这里搞出来的啊那么其实通过runtime完全可以重写这个方法、当然绝对不仅仅是简单的给他封一层那么简单<br />
首先你先需要找到这个方法是在哪儿的、最简单的方法就是故意越界让他报次错看看嘛Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[__NSArrayI objectAtIndex:]<br />
看到了吧就是 _NSArrayI里<br />
然后需要做的就是很简单了</p>
<pre lang="objective-c">
Method method_ObjectAtIndex = class_getInstanceMethod(NSClassFromString(@"__NSArrayI"),@selector(objectAtIndex:));
Method method_SafeObjectAtIndex = class_getInstanceMethod(NSClassFromString(@"NSArray"),@selector(safeObjectAtIndex:));//这个方法就是一会自己写的拓展进nsarray中的
method_exchangeImplementations(method_ObjectAtIndex, method_SafeObjectAtIndex);//然后交换就是这么简单 不过这个危险性也是极大的比如整个系统所有的调用这个原生api的调用就全都走到你这来了、必须必须要确保正确性……

//然后就简单的加个category的实现就好了
@implementation NSArray(SafeExtenstion)
- (id)safeObjectAtIndex:(NSUInteger)index
{
    NSLog(@"wake %@--%@",NSStringFromSelector(_cmd),self);
    if (self.count <= index) return nil;
    return [self safeObjectAtIndex:index];
}
@end
</pre>
<p>这样就可以自己去复写掉一些认为系统实现的很傻逼的方法了吧、runtime的适用场景我想还远远不止这些呢</p>
