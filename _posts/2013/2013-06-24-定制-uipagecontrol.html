---
layout: post
title: 定制 UIPageControl
categories:
- program
tags: []
published: true
comments: true
---
<p>pagecontrol 就是iphone上面比如scrollview翻图片时候下面那个小点点<br />
其实我个人觉得还是挺美观的……可是需求就是要自己的图片替掉……然后死人苹果又不给api、所以也就只能自己复写实现了<br />
先说下ios7之前 那些点点的实现非常简单 就是UIPageControl.subviews 就是一个个点的UIImageView 所以只需简单的替换掉就好了代码如下
<pre lang="c">
@property(nonatomic,strong)UIImage *_activeImage;
@property(nonatomic,strong)UIImage *_inactiveImage;
//在init的时候把你自己定义的两张图片搞进去
- (void)updateDots
{
    for (int i = 0; i< [self.subviews count]; i++) {
        UIImageView* dot =[self.subviews objectAtIndex:i];</pre></p>

<p>        if (i == self.currentPage) {<br />
            if ([dot respondsToSelector:@selector(setImage:)]) {<br />
                dot.image=_activeImage;<br />
            }</p>

<p>        } else {<br />
            if ([dot respondsToSelector:@selector(setImage:)]) {<br />
                dot.image=_inactiveImage;<br />
            }<br />
        }<br />
    }<br />
}
//然后自己重载一下setNumber就好了</p>

<p>- (void)setNumberOfPages:(NSInteger)numberOfPages<br />
{
    [super setNumberOfPages:numberOfPages];<br />
    [self updateDots];<br />
}

但是呢万恶的ios7改掉了尼玛……连底层实现都改啊混蛋……可以对self.subviews 标红一下就明白了……整个pagecontrol的uivew乱七八糟……而且都是view根本就没了image属性、换句话说现在的那些小点点都是代码写出来的了、而不是简单图了<br />
实现起来就要重写UIView的绘画函数了代码大致如下
<pre lang="c">
#import "ZDPageControll.h"
#import <QuartzCore/QuartzCore.h></pre></p>

<p>@interface ZDPageControll()<br />
{
    UIImage *_activeImage;<br />
    UIImage *_inactiveImage;<br />
    NSArray *_usedToRetainOriginalSubview;<br />
}</p>

<p>@end</p>

<p>@implementation ZDPageControll<br />
@synthesize kSpacing=_kSpacing;<br />
- (id)initWithFrame:(CGRect)frame currentImageName:(NSString *)current commonImageName:(NSString *)common<br />
{
    self= [super initWithFrame:frame];<br />
    if ([self respondsToSelector:@selector(setCurrentPageIndicatorTintColor:)] && [self respondsToSelector:@selector(setPageIndicatorTintColor:)]) {<br />
        [self setCurrentPageIndicatorTintColor:[UIColor clearColor]];<br />
        [self setPageIndicatorTintColor:[UIColor clearColor]];<br />
    }<br />
    <br />
    [self setBackgroundColor:[UIColor clearColor]];<br />
    _activeImage= [UIImage imageNamed:current];<br />
    _inactiveImage= [UIImage imageNamed:common];<br />
    _kSpacing=10.0f;<br />
    //hold住原来pagecontroll的subview<br />
    _usedToRetainOriginalSubview=[NSArray arrayWithArray:self.subviews];<br />
    for (UIView *su in self.subviews) {<br />
        [su removeFromSuperview];<br />
    }<br />
    self.contentMode=UIViewContentModeRedraw;<br />
    return self;<br />
}
-(void)dealloc<br />
{
    //释放原来hold住的那些subview<br />
    _usedToRetainOriginalSubview=nil;<br />
    _activeImage=nil;<br />
    _inactiveImage=nil;<br />
}
- (void)updateDots<br />
{</p>

<p>    for (int i = 0; i< [self.subviews count]; i++) {<br />
        UIImageView* dot =[self.subviews objectAtIndex:i];</p>

<p>        if (i == self.currentPage) {<br />
            if ([dot respondsToSelector:@selector(setImage:)]) {<br />
                dot.image=_activeImage;<br />
            }</p>

<p>        } else {<br />
            if ([dot respondsToSelector:@selector(setImage:)]) {<br />
                dot.image=_inactiveImage;<br />
            }<br />
        }<br />
    }</p>

<p>}</p>

<p>- (void)setCurrentPage:(NSInteger)currentPage<br />
{
    [super setCurrentPage:currentPage];<br />
    if ([[[UIDevice currentDevice]systemVersion]floatValue] <=6.0) {<br />
        [self updateDots];<br />
    }<br />
//    [self updateDots];<br />
    [self setNeedsDisplay];<br />
}
- (void)setNumberOfPages:(NSInteger)numberOfPages<br />
{
    [super setNumberOfPages:numberOfPages];<br />
    if ([[[UIDevice currentDevice]systemVersion]floatValue] <=6.0) {<br />
        [self updateDots];<br />
    }<br />
//    [self updateDots];<br />
    [self setNeedsDisplay];</p>

<p>}<br />
-(void)drawRect:(CGRect)iRect<br />
{
    int i;<br />
    CGRect rect;<br />
    <br />
    UIImage *image;<br />
    iRect = self.bounds;<br />
    <br />
    if ( self.opaque ) {<br />
        [self.backgroundColor set];<br />
        UIRectFill( iRect );<br />
    }<br />
    <br />
    if ( self.hidesForSinglePage && self.numberOfPages == 1 ) return;<br />
    <br />
    rect.size.height = _activeImage.size.height;<br />
    rect.size.width = self.numberOfPages * _activeImage.size.width + ( self.numberOfPages - 1 ) * _kSpacing;<br />
    rect.origin.x = floorf( ( iRect.size.width - rect.size.width ) / 2.0 );<br />
    rect.origin.y = floorf( ( iRect.size.height - rect.size.height ) / 2.0 );<br />
    rect.size.width = _activeImage.size.width;<br />
    <br />
    for ( i = 0; i < self.numberOfPages; ++i ) {<br />
        image = i == self.currentPage ? _activeImage : _inactiveImage;<br />
        <br />
        [image drawInRect: rect];<br />
        <br />
        rect.origin.x += _activeImage.size.width + _kSpacing;<br />
    }<br />
}
@end</p>

<p></p>
