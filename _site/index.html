
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>snorlax's Homepage</title>
    
    <meta name="author" content="Xinzheng Zhang">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments.css?body=1" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Snorlax's blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archives</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




          </ul>
        </div>
      </div>
    </div>
    <div class="container_wrapper">
      <div class="container-narrow">
        <div class="content">
          <!-- <ul class="listing"> -->

<div class="page-header">
  <h3><a href="/program/2015/02/20/inject-qq">注入qq </a></h3>
  <div class="date">
    <span>20 February 2015</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h4>背景</h4>

<ul>
<li>像除夕这种好时节……tx什么红包发疯了那么安全性呢= =脑洞一开我就试试我这么个完全没碰过反向的人能玩成什么样子</li>
</ul>

<h4>准备</h4>

<ul>
<li>一台越狱设备</li>
<li>安装OpenSSH MobileSubstrate</li>
</ul>

<h4>步骤</h4>

<ul>
<li><p>首先需要进行qq页面的分析、这个时候就该祭出神器<code>reveal</code>了hhhh</p>

<ul>
<li>把<code>/Applications/Reveal.app/Contents/SharedSupport/iOS-Libraries/Reveal.framework</code>放到<code>/System/Library/Frameworks</code></li>
<li>把<code>/Applications/Reveal.app/Contents/SharedSupport/iOS-Libraries/libReveal.dylib</code>放到<code>/Library/MobileSubstrate/DynamicLibraries</code></li>
<li>在<code>/Library/MobileSubstrate/DynamicLibraries/</code>写一个<code>libReveal.plist</code>文件内容为</li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{   
    Filter = {  
         Bundles = (&quot;com.tencent.mqq&quot;);   
    };   
}  
</code></pre></div>
<ul>
<li>ps. 关于qq的bundle name可以直接去看mediaplist或者注入后自己dump <code>[[NSBundle mainBundle] infoDictionary][@&quot;CFBundleIdentifier&quot;]</code></li>
<li><img src="/assets/static/2015-02-20-1.png" alt="结构嘛= =就是这个样子地!"></li>
</ul></li>
<li><p>接下去开始要真正的搞反向了、我选择了注入了最广泛也是最安全的一个函数<code>viewDidAppear:</code></p>

<ul>
<li>嗯感谢oc的runtime提供强大的方法ˊ_&gt;ˋ</li>
<li> </li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">static void __attribute__((constructor)) initialize(void)  
{
NSLog(@&quot;---------------inject----------------&quot;);
NSLog(@&quot;%@&quot;,[[NSBundle mainBundle] infoDictionary][@&quot;CFBundleIdentifier&quot;]);

Class class = objc_getClass(&quot;UIViewController&quot;);
Method ori_Method =  class_getInstanceMethod(class, @selector(viewDidAppear:));
Method my_Method = class_getInstanceMethod(class, @selector(injectedViewDidAppear:));
method_exchangeImplementations(ori_Method, my_Method);
}
</code></pre></div>
<ul>
<li>然后我们要找到<code>QQGroupChatViewController</code>然后钩进去=-=记得还要再调一遍原声方法否则要出bug的哟</li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-(void)injectedViewDidAppear:(BOOL)an
{  
NSLog(@&quot;-------viewDidAppear entered-------&quot;);
if ([self isKindOfClass:NSClassFromString(@&quot;QQGroupChatViewController&quot;)]) {
    [self injectEntranceccc];
}
// 现在你已经有viewController 的句柄了哟～～～～！
[self injectedViewDidAppear:an];
}
</code></pre></div>
<ul>
<li>然后找到那个cell了那么以下你有几种选择试验咯具体是哪儿个我也不告诉你=-=

<ul>
<li>找到他的delegate去钩他的didselect方法</li>
<li>找到他下面的UIControl事件模拟touch</li>
<li>看他上面绑定的UIGestureRecognizer然后模拟</li>
</ul></li>
</ul></li>
<li><p>好了我们的注入代码搞定了那么最后该注入进去了咯？</p>

<ul>
<li>首先理论上应该直接用clang进行编译……可是我太菜实在拼不出那坨正确的编译参数所以还是借靠了xcode、随便把注入写进一个<code>x.m</code>然后build起来(记得build要build你机型的那个哦、比如虚拟机上直接跑肯定是x86的我是ipod5所以编译的是armv7)</li>
<li>我们可以在show the report nagivator -&gt; build -&gt; x.m 进行展开看到那一坨又臭又长的编译参数了吧= =我们的目的是要看 -o 然后就找到.o 的目标位置啦</li>
<li>接下去就是链接啦<code>ld -dylib -lsystem -lobjc -syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk -o libij.dylib test.o</code></li>
<li>最后最后！把libij.dylib 塞去<code>/Library/MobileSubstrate/DynamicLibraries/libij.dylib</code> 把 <code>libij.plist</code>塞去哪儿？自己想!</li>
<li>重启-----大功告成</li>
</ul></li>
<li><p>嗯我就是没有给你们<code>injectEntranceccc</code>的实现、总需要有自己的试错嘛=-=</p>

<ul>
<li><img src="/assets/static/2015-02-20-2.jpg" alt="结构嘛= =就是这个样子地!"></li>
</ul></li>
</ul>

<h4>最后</h4>

<ul>
<li>最后最后我再也不会越狱了。。妈蛋我这种菜鸡都可以想搞什么搞什么不用说别人了……</li>
<li>runtime真可怕系列</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#reverse-ref">reverse <span>1</span></a></li>
    
    	<li><a href="#objective-c-ref">objective-c <span>3</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/17/catch-errors-in-rac">ReactiveCocoa中RAC绑定中错误处理 </a></h3>
  <div class="date">
    <span>17 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>背景</h3>

<ul>
<li>大致情况是bind了一个<code>NSData</code>到一个由<code>NSURLConnection</code>拓展出来的signal中、当网络请求超时时一定发生crash</li>
</ul>

<h4>关键代码</h4>

<ul>
<li><p><code>RACSignal+Operations.m</code> line 629-643 </p>

<ul>
<li>查看RAC宏定义发现入口时下面</li>
<li><code>- (RACDisposable *)setKeyPath:(NSString *)keyPath onObject:(NSObject *)object nilValue:(id)nilValue;</code></li>
<li>如下代码中可以发现其实在当error时候直接assert掉了关于这里作者是这么说的

<ul>
<li>Errors that occur in a property binding are generally not corrupting. You&#39;re more likely to see weird UI glitches than a completely broken document, so crashing may be an unreasonable response.</li>
<li>But, of course, we really have no way of knowing. Maybe we should just fail fast.</li>
</ul></li>
<li>不过个人认为这也只是在可控制状态下这样强硬的要求也的确不错、可是在比如网络请求下就出大坑了……</li>
</ul>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c">    <span class="n">RACDisposable</span> <span class="o">*</span><span class="n">subscriptionDisposable</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">subscribeNext</span><span class="o">:^</span><span class="p">(</span><span class="kt">id</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSObject</span> <span class="o">*</span><span class="n">object</span> <span class="o">=</span> <span class="p">(</span><span class="n">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="n">objectPtr</span><span class="p">;</span>
        <span class="p">[</span><span class="n">object</span> <span class="n">setValue</span><span class="o">:</span><span class="n">x</span> <span class="o">?:</span> <span class="n">nilValue</span> <span class="n">forKeyPath</span><span class="o">:</span><span class="n">keyPath</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">error</span><span class="o">:^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSObject</span> <span class="o">*</span><span class="n">object</span> <span class="o">=</span> <span class="p">(</span><span class="n">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="n">objectPtr</span><span class="p">;</span>

        <span class="n">NSCAssert</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="s">@&quot;Received error from %@ in binding for key path </span><span class="se">\&quot;</span><span class="s">%@</span><span class="se">\&quot;</span><span class="s"> on %@: %@&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">,</span> <span class="n">object</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

        <span class="c1">// Log the error if we&#39;re running with assertions disabled.</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Received error from %@ in binding for key path </span><span class="se">\&quot;</span><span class="s">%@</span><span class="se">\&quot;</span><span class="s"> on %@: %@&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">,</span> <span class="n">keyPath</span><span class="p">,</span> <span class="n">object</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

        <span class="p">[</span><span class="n">disposable</span> <span class="n">dispose</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">completed</span><span class="o">:^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">disposable</span> <span class="n">dispose</span><span class="p">];</span>
    <span class="p">}];</span>
</code></pre></div></li>
<li><p>继续看<code>NSURLConnection+RACSupport.m</code>中的对NSURLConnection中的拓展</p></li>
<li><p>其中最致命的问题也就是当在一个request回来时判定了当data为空时直接向signal send error了、这也就导致了为什么仅仅只是在超时的时候发送了error、而没有在别的网络错误时crash、因为那个时候data虽然不是你想要的但至少不是空</p>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c"><span class="k">+</span> <span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">rac_sendAsynchronousRequest:</span><span class="p">(</span><span class="n">NSURLRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span> <span class="p">{</span>
    <span class="n">NSCParameterAssert</span><span class="p">(</span><span class="n">request</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">RACSignal</span>
        <span class="nl">createSignal:</span><span class="o">^</span> <span class="n">RACDisposable</span> <span class="o">*</span> <span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">RACSubscriber</span><span class="o">&gt;</span> <span class="n">subscriber</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="n">queue</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">@&quot;com.github.ReactiveCocoa.NSURLConnectionRACSupport&quot;</span><span class="p">;</span>

            <span class="p">[</span><span class="n">NSURLConnection</span> <span class="n">sendAsynchronousRequest</span><span class="o">:</span><span class="n">request</span> <span class="n">queue</span><span class="o">:</span><span class="n">queue</span> <span class="n">completionHandler</span><span class="o">:^</span><span class="p">(</span><span class="n">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="n">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">[</span><span class="n">subscriber</span> <span class="n">sendError</span><span class="o">:</span><span class="n">error</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="p">[</span><span class="n">subscriber</span> <span class="n">sendNext</span><span class="o">:</span><span class="n">RACTuplePack</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="p">)];</span>
                    <span class="p">[</span><span class="n">subscriber</span> <span class="n">sendCompleted</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}];</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">RACDisposable</span> <span class="n">disposableWithBlock</span><span class="o">:^</span><span class="p">{</span>
                <span class="c1">// It&#39;s not clear if this will actually cancel the connection,</span>
                <span class="c1">// but we can at least prevent _some_ unnecessary work --</span>
                <span class="c1">// without writing all the code for a proper delegate, which</span>
                <span class="c1">// doesn&#39;t really belong in RAC.</span>
                <span class="n">queue</span><span class="p">.</span><span class="n">suspended</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
                <span class="p">[</span><span class="n">queue</span> <span class="n">cancelAllOperations</span><span class="p">];</span>
            <span class="p">}];</span>
        <span class="p">}]</span>
        <span class="nl">setNameWithFormat:</span><span class="s">@&quot;+rac_sendAsynchronousRequest: %@&quot;</span><span class="p">,</span> <span class="n">request</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>

<h4>问题代码</h4>

<ul>
<li><p><code>RAC(photoModel, fullsizedData) = [self download:photoModel.fullsizedURL];</code> 其中fullsizeData为一个NSData</p>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c"><span class="k">+</span><span class="p">(</span><span class="n">RACSignal</span> <span class="o">*</span><span class="p">)</span><span class="nf">download:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">urlString</span> <span class="p">{</span>
    <span class="n">NSAssert</span><span class="p">(</span><span class="n">urlString</span><span class="p">,</span> <span class="s">@&quot;URL must not be nil&quot;</span><span class="p">);</span>

    <span class="n">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURLRequest</span> <span class="n">requestWithURL</span><span class="o">:</span><span class="p">[</span><span class="n">NSURL</span> <span class="n">URLWithString</span><span class="o">:</span><span class="n">urlString</span><span class="p">]];</span>
    <span class="k">return</span> <span class="p">[[[</span><span class="n">NSURLConnection</span> <span class="n">rac_sendAsynchronousRequest</span><span class="o">:</span><span class="n">request</span><span class="p">]</span> <span class="n">reduceEach</span><span class="o">:^</span><span class="kt">id</span><span class="p">(</span><span class="n">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="n">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
    <span class="p">}]</span> <span class="n">deliverOn</span><span class="o">:</span><span class="p">[</span><span class="n">RACScheduler</span> <span class="n">mainThreadScheduler</span><span class="p">]];</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>

<h4>发生原因梳理</h4>

<ul>
<li>RAC 绑定了一个由 NSURLConnection 的 rac_sendAsynchronousRequest生成出的signal</li>
<li>在网络超时时候发出了error信号、导致rac绑定crash</li>
</ul>

<h4>问题解决方法</h4>

<ul>
<li><p>在subscribe那个网络信号的时候进行catch error操作</p>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c"><span class="p">[[[[</span><span class="n">NSURLConnection</span> <span class="n">rac_sendAsynchronousRequest</span><span class="o">:</span><span class="n">request</span><span class="p">]</span> <span class="n">reduceEach</span><span class="o">:^</span><span class="kt">id</span><span class="p">(</span><span class="n">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="n">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}]</span> <span class="n">deliverOn</span><span class="o">:</span><span class="p">[</span><span class="n">RACScheduler</span> <span class="n">mainThreadScheduler</span><span class="p">]]</span> <span class="n">catch</span><span class="o">:^</span><span class="n">RACSignal</span><span class="o">*</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">){</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error =%@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RACSignal</span> <span class="n">empty</span><span class="p">];</span>
<span class="p">}];</span>
</code></pre></div></li>
<li><p>在 <a href="https://github.com/ReactiveCocoa/ReactiveCocoa/commit/37bbe0d5340e5180db111694f584f927df474824">传送门</a>这个pull request之中……当然这是个针对swift的branch中加入了<code>errorHandler</code><a href="https://github.com/ReactiveCocoa/ReactiveCocoa/commit/09c3d739579abfc51df5d56ed0c7e09c20a8fac8">传送门</a>解决了这个问题</p></li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#ReactiveCocoa-ref">ReactiveCocoa <span>1</span></a></li>
    
    	<li><a href="#objective-c-ref">objective-c <span>3</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/14/regular-expression">正则表达式——BRE与ERE区别 </a></h3>
  <div class="date">
    <span>14 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>本文主要说明了正则的两个标准 BRE 以及 ERE的具体区别</h3>

<ul>
<li>BRE - Basic Regular Syntax ， ERE - Extended Regular Syntax 顾名思义ere是对bre的拓展。</li>
<li><p>但是两种语法也都必须要记因为很多Unix程序用的并没有统一。</p>

<table><thead>
<tr>
<th></th>
<th>BRE</th>
<th>ERE</th>
</tr>
</thead><tbody>
<tr>
<td>grep</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>sed</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>ed</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>vi</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>more</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>egrep</td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>awk</td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>lex</td>
<td></td>
<td>√</td>
</tr>
</tbody></table></li>
</ul>

<h3>公共meta部分</h3>

<ul>
<li><code>\</code> 

<ul>
<li>用来关闭后续字符意义例如 <code>\&#39;  \&quot;</code> </li>
<li>在BRE中特别有打开字符意义的意思例如 <code>\(...\)</code> <code>\{...\}</code></li>
</ul></li>
<li><code>.</code>

<ul>
<li>用来匹配单个字符</li>
</ul></li>
<li><code>*</code>

<ul>
<li>匹配0-n个字符</li>
</ul></li>
<li><code>^</code>

<ul>
<li>锚点、行首起始处</li>
<li>在BRE中必须需要在表达式开头才有效

<ul>
<li><code>echo abc | grep &quot;.*^a&quot;</code> ×</li>
<li><code>echo abc | egrep &quot;.*^a&quot;</code> √</li>
</ul></li>
</ul></li>
<li><code>$</code>

<ul>
<li>锚点、行尾结尾处</li>
<li>同上在BRE中必须要在结尾处才有效</li>
</ul></li>
<li><p><code>[...]</code></p>

<ul>
<li><code>[^...]</code> 取...的反</li>
<li><code>[x-y]</code> 匹配 x-y 之间的  例如 x=1 y=9 or x=a y=z</li>
<li><p><code>[express]</code> 匹配express的字符集  例如 express=[:alnum:] [[:alnum:]] 匹配数字字符</p>

<table><thead>
<tr>
<th>类别</th>
<th>意义</th>
</tr>
</thead><tbody>
<tr>
<td>[:alnum:]</td>
<td>数字</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>字母</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>space or tab</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>控制字符</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>数字</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>除了空格字符</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>小写字母</td>
</tr>
<tr>
<td>[:print:]</td>
<td>可显示的字符</td>
</tr>
<tr>
<td>[:puncat:]</td>
<td>标点</td>
</tr>
<tr>
<td>[:space:]</td>
<td>空白</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>大写字母</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>16进制数字</td>
</tr>
</tbody></table></li>
</ul></li>
<li><p><code>\n</code></p>

<ul>
<li>在BRE中为重复(...)的第n个表达式且当时位置匹配的结果于他所代表的那个结果相同

<ul>
<li><code>echo axa | grep &quot;\([ab]\)x\1&quot;</code> √</li>
<li><code>echo axb | grep &quot;\([ab]\)x\1&quot;</code> ×</li>
</ul></li>
<li>在ERE中为重复()的第n个表达式

<ul>
<li><code>echo axa | egrep &quot;([ab])x\1&quot;</code> √</li>
<li><code>echo axb | egrep &quot;([ab])x\1&quot;</code> ×</li>
</ul></li>
</ul></li>
</ul>

<h3>BRE meta部分</h3>

<ul>
<li><code>\{n,m\}</code>

<ul>
<li>匹配前面单个字符的次数区间为n-m次 

<ul>
<li><code>\{n\}</code> 重现n次</li>
<li><code>\{n,\}</code> 至少出现n次</li>
</ul></li>
</ul></li>
<li><code>\(...\)</code>

<ul>
<li>匹配...子模式的 可以通过上述的<code>\n</code>来引用</li>
</ul></li>
</ul>

<h3>ERE meta部分</h3>

<ul>
<li><code>{n,m}</code>

<ul>
<li>同BRE匹配单个字符n-m次</li>
</ul></li>
<li><code>+</code>

<ul>
<li>匹配一个或n个</li>
</ul></li>
<li><code>?</code>

<ul>
<li>匹配0个或1个</li>
</ul></li>
<li><code>|</code>

<ul>
<li>匹配 | 前后的表达式</li>
</ul></li>
<li><code>(...)</code>

<ul>
<li>同BRE中的<code>\(...\)</code></li>
</ul></li>
</ul>

<h3>BRE 优先级 &gt;</h3>

<ul>
<li><code>[...]</code> 方括号中的具体转义</li>
<li><code>\metacharacter</code> 转义的meta字符</li>
<li><code>[]</code> 方括号表达式</li>
<li><code>\(...\)...\n</code> 子表达式后向引用</li>
<li><code>\{...\}</code> * 单置字符重现</li>
<li><code>...</code> 连续字符</li>
<li><code>^ $</code> 锚点</li>
</ul>

<h3>ERE 优先级 &gt;</h3>

<ul>
<li><code>[...]</code> 方括号中的具体转义</li>
<li><code>\metacharacter</code> 转义的meta字符</li>
<li><code>[]</code> 方括号表达式</li>
<li><code>(...)...\n</code> 子表达式后向引用</li>
<li><code>+ ? * {}</code> 单置字符重现</li>
<li><code>...</code> 连续字符</li>
<li><code>^ $</code> 锚点</li>
<li><code>|</code> 选择</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#re-ref">re <span>2</span></a></li>
    
    	<li><a href="#shell-ref">shell <span>2</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/14/difference-between-bre-and-ere">正则表达式——BRE与ERE区别 </a></h3>
  <div class="date">
    <span>14 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>本文主要说明了正则的两个标准 BRE 以及 ERE的具体区别</h3>

<ul>
<li>BRE - Basic Regular Syntax ， ERE - Extended Regular Syntax 顾名思义ere是对bre的拓展。</li>
<li><p>但是两种语法也都必须要记因为很多Unix程序用的并没有统一。</p>

<table><thead>
<tr>
<th></th>
<th>BRE</th>
<th>ERE</th>
</tr>
</thead><tbody>
<tr>
<td>grep</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>sed</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>ed</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>vi</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>more</td>
<td>√</td>
<td></td>
</tr>
<tr>
<td>egrep</td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>awk</td>
<td></td>
<td>√</td>
</tr>
<tr>
<td>lex</td>
<td></td>
<td>√</td>
</tr>
</tbody></table></li>
</ul>

<h3>公共meta部分</h3>

<ul>
<li><code>\</code> 

<ul>
<li>用来关闭后续字符意义例如 <code>\&#39;  \&quot;</code> </li>
<li>在BRE中特别有打开字符意义的意思例如 <code>\(...\)</code> <code>\{...\}</code></li>
</ul></li>
<li><code>.</code>

<ul>
<li>用来匹配单个字符</li>
</ul></li>
<li><code>*</code>

<ul>
<li>匹配0-n个字符</li>
</ul></li>
<li><code>^</code>

<ul>
<li>锚点、行首起始处</li>
<li>在BRE中必须需要在表达式开头才有效

<ul>
<li><code>echo abc | grep &quot;.*^a&quot;</code> ×</li>
<li><code>echo abc | egrep &quot;.*^a&quot;</code> √</li>
</ul></li>
</ul></li>
<li><code>$</code>

<ul>
<li>锚点、行尾结尾处</li>
<li>同上在BRE中必须要在结尾处才有效</li>
</ul></li>
<li><p><code>[...]</code></p>

<ul>
<li><code>[^...]</code> 取...的反</li>
<li><code>[x-y]</code> 匹配 x-y 之间的  例如 x=1 y=9 or x=a y=z</li>
<li><p><code>[express]</code> 匹配express的字符集  例如 express=[:alnum:] [[:alnum:]] 匹配数字字符</p>

<table><thead>
<tr>
<th>类别</th>
<th>意义</th>
</tr>
</thead><tbody>
<tr>
<td>[:alnum:]</td>
<td>数字</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>字母</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>space or tab</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>控制字符</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>数字</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>除了空格字符</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>小写字母</td>
</tr>
<tr>
<td>[:print:]</td>
<td>可显示的字符</td>
</tr>
<tr>
<td>[:puncat:]</td>
<td>标点</td>
</tr>
<tr>
<td>[:space:]</td>
<td>空白</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>大写字母</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>16进制数字</td>
</tr>
</tbody></table></li>
</ul></li>
<li><p><code>\n</code></p>

<ul>
<li>在BRE中为重复(...)的第n个表达式且当时位置匹配的结果于他所代表的那个结果相同

<ul>
<li><code>echo axa | grep &quot;\([ab]\)x\1&quot;</code> √</li>
<li><code>echo axb | grep &quot;\([ab]\)x\1&quot;</code> ×</li>
</ul></li>
<li>在ERE中为重复()的第n个表达式

<ul>
<li><code>echo axa | egrep &quot;([ab])x\1&quot;</code> √</li>
<li><code>echo axb | egrep &quot;([ab])x\1&quot;</code> ×</li>
</ul></li>
</ul></li>
</ul>

<h3>BRE meta部分</h3>

<ul>
<li><code>\{n,m\}</code>

<ul>
<li>匹配前面单个字符的次数区间为n-m次 

<ul>
<li><code>\{n\}</code> 重现n次</li>
<li><code>\{n,\}</code> 至少出现n次</li>
</ul></li>
</ul></li>
<li><code>\(...\)</code>

<ul>
<li>匹配...子模式的 可以通过上述的<code>\n</code>来引用</li>
</ul></li>
</ul>

<h3>ERE meta部分</h3>

<ul>
<li><code>{n,m}</code>

<ul>
<li>同BRE匹配单个字符n-m次</li>
</ul></li>
<li><code>+</code>

<ul>
<li>匹配一个或n个</li>
</ul></li>
<li><code>?</code>

<ul>
<li>匹配0个或1个</li>
</ul></li>
<li><code>|</code>

<ul>
<li>匹配 | 前后的表达式</li>
</ul></li>
<li><code>(...)</code>

<ul>
<li>同BRE中的<code>\(...\)</code></li>
</ul></li>
</ul>

<h3>BRE 优先级 &gt;</h3>

<ul>
<li><code>[...]</code> 方括号中的具体转义</li>
<li><code>\metacharacter</code> 转义的meta字符</li>
<li><code>[]</code> 方括号表达式</li>
<li><code>\(...\)...\n</code> 子表达式后向引用</li>
<li><code>\{...\}</code> * 单置字符重现</li>
<li><code>...</code> 连续字符</li>
<li><code>^ $</code> 锚点</li>
</ul>

<h3>ERE 优先级 &gt;</h3>

<ul>
<li><code>[...]</code> 方括号中的具体转义</li>
<li><code>\metacharacter</code> 转义的meta字符</li>
<li><code>[]</code> 方括号表达式</li>
<li><code>(...)...\n</code> 子表达式后向引用</li>
<li><code>+ ? * {}</code> 单置字符重现</li>
<li><code>...</code> 连续字符</li>
<li><code>^ $</code> 锚点</li>
<li><code>|</code> 选择</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#re-ref">re <span>2</span></a></li>
    
    	<li><a href="#shell-ref">shell <span>2</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/14/design-pattern-3">Design Pattern (4) </a></h3>
  <div class="date">
    <span>14 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>大话设计模式的读书笔记（四）</h3>

<ul>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-0/">读书笔记（一）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-1/">读书笔记（二）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-2/">读书笔记（三）</a></li>
</ul>

<h3>Bridge, Command, Chain Of Responsibility, Mediator, Flyweight, Interpreter, Visitor</h3>

<h4>桥接模式</h4>

<ul>
<li>桥接模式的定义为「将抽象不分与实现部分分离，使之可以独立变化」</li>
<li><p>简单来说就比如python 把语言核心逻辑抽象出PVM具体实现根据是当前什么平台再分别处理、使用也使用的是抽象接口
由实现者abstraction获得抽象的implementor并具体实现</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">Implementor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Abstraction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">implementor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">implementor</span><span class="o">.</span><span class="n">operation</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ConcreteImplementorA</span><span class="p">(</span><span class="n">Implementor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;implementor A&quot;</span>

<span class="k">class</span> <span class="nc">ConcreteAbstraction</span><span class="p">(</span><span class="n">Abstraction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Abstraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">operation</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ab</span> <span class="o">=</span> <span class="n">ConcreteAbstraction</span><span class="p">()</span>
    <span class="n">ab</span><span class="o">.</span><span class="n">implementor</span> <span class="o">=</span> <span class="n">ConcreteImplementorA</span><span class="p">()</span>
    <span class="n">ab</span><span class="o">.</span><span class="n">operation</span><span class="p">()</span>
</code></pre></div></li>
</ul>

<h4>命令模式</h4>

<ul>
<li>命令模式是把一个请求进行多一道转移、通过一个统一的invoker进行一起的操作</li>
<li><p>例如ios中dispatch_async等操作或者任意的线程池都是这个思路、任何request只管我来托管、具体怎么操作由我自己来决定这个模式也是非常常见的</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span> <span class="o">=</span> <span class="n">receiver</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreteCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiver</span><span class="o">.</span><span class="n">action</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Receiver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;do sth&quot;</span>

<span class="k">class</span> <span class="nc">Invoker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>

    <span class="k">def</span> <span class="nf">execute_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Receiver</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">ConcreteCommand</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">Invoker</span><span class="p">()</span>
    <span class="n">i</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">execute_command</span><span class="p">()</span>
</code></pre></div></li>
</ul>

<h4>职责链模式</h4>

<ul>
<li>职责链模式的核心我理解的是把担负责任的对象抽象出公共、并对每个节点不关心其周边节点、只关心与他需要传递的节点核心好处就是避免了客户端上需要对整个职责具体模块的掌握、就像上班只需要关注上级领导即可</li>
<li><p>具体来说还是拿ios来说、比如触碰下屏幕、他并不知道你点击的到底是哪儿个button、他一层层先给他的直接交互UIWindow然后再由他传递他的第一层view等等直到找到该负责的那个button为止。或者说就像一个request进服务器他并不知道他是给具体的业务是谁、他先去找nginx、然后nginx再去分发给相关的、再进到具体的某个业务层逻辑一样道理</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass</span> <span class="o">=</span> <span class="n">ABCMeta</span>
    <span class="k">def</span> <span class="nf">set_successor</span><span class="p">(</span><span class="n">successor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successor</span> <span class="o">=</span> <span class="n">successor</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreateHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;deal it&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">ConcreateHandler</span><span class="p">()</span>
    <span class="n">h</span><span class="o">.</span><span class="n">set_successor</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h4>中介者模式</h4>

<ul>
<li>其实这东西感觉是不是办法的办法。。虽然说初衷的确能够理解。举个例子就是有10个人、每个人和另外9个人都有一种接触方式、那么一共就有45种规则。并且每个人里都需要记录9种规则。于是就抽象出一个规则列表、里面记录了45种规则、所有的具体问题全去找中介者。也就是多对多的关系。</li>
<li><p>不过我理解这种脏活也是在所难免的、比如一个UI层的渲染再怎么拆分开总有需要合并起来的地方、而上层拆的越开越清晰、倒霉的肯定是下层的强大逻辑。</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">Mediator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">colleague</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Colleague</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mediator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span> <span class="o">=</span> <span class="n">mediator</span>

<span class="k">class</span> <span class="nc">ConcreteMediator</span><span class="p">(</span><span class="n">Mediator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_colleague1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colleague</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colleague1</span> <span class="o">=</span> <span class="n">colleague</span>

    <span class="k">def</span> <span class="nf">set_colleague2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colleague</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colleague2</span> <span class="o">=</span> <span class="n">colleague</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">colleague</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">colleague</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">colleague1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colleague2</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colleague1</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ConcreteColleague1</span><span class="p">(</span><span class="n">Colleague</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;c1 dosth&quot;</span>

<span class="k">class</span> <span class="nc">ConcreteColleague2</span><span class="p">(</span><span class="n">Colleague</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;c2 dosth&quot;</span> 

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteMediator</span><span class="p">()</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">ConcreteColleague1</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">c2</span><span class="o">=</span> <span class="n">ConcreteColleague2</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">set_colleague1</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">set_colleague2</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;hi1&quot;</span><span class="p">)</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;hi2&quot;</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h4>享元模式</h4>

<ul>
<li><p>定义为「运用共享技术有效地支持大量细粒度的对象」核心的话就是抽出公共、独立出私有的。我太菜大概只能理解到除了省内存这一点而已。。</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Flyweight</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrinsicstate</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreteFlyweight</span><span class="p">(</span><span class="n">Flyweight</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrinsicstate</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;do{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extrinsicstate</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UnSharedCOncreteFlyweight</span><span class="p">(</span><span class="n">Flyweight</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrinsicstate</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;unshared{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extrinsicstate</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FlyweightFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flyweights</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_flyweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flyweights</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flyweights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConcreteFlyweight</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flyweights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">FlyweightFactory</span><span class="p">()</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_flyweight</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_flyweight</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">ux3</span> <span class="o">=</span> <span class="n">UnSharedCOncreteFlyweight</span><span class="p">()</span>

    <span class="n">x1</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x2</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ux3</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h3>解释器模式</h3>

<ul>
<li>大概我觉得我最喜欢这个了Orz……自己定义一套语法去解释一套东西而不去用各种复杂的OO的东西大概是我最喜欢的了……</li>
<li><p>我又来qb vfl(Visual Format Language)了……同样是在ios里面把复杂的constraints抽象成一套自己定义的语言真是舒服级了。。。</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">AbstractExpression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">interpret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">TerminalExpression</span><span class="p">(</span><span class="n">AbstractExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">interpret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;interpret {0} in {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">TerminalExpression</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="s">&quot;dosth&quot;</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h4>访问者模式</h4>

<ul>
<li>我理解的访问者模式是把不同人在不同状态做的事情、2个数据model给解耦了。把状态全都丢进了一个公共处理的objectStructure、然后针对每个不同的访问者然后做出相应的处理</li>
<li><p>访问者的有点是因为抽象出公共的处理部分了、所以再他的基础上添加新的行为非常方便，就多一种element而已、但是如果在数据结构层次的修改的话就蛋疼了。</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Visitor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">visit_concrete_element_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concrete_element_a</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">visit_concrete_element_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concrete_element_b</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreteVisitor1</span><span class="p">(</span><span class="n">Visitor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">visit_concrete_element_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concrete_element_a</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;{0} was visited by {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">concrete_element_a</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_concrete_element_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concrete_element_b</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;{0} was visited by {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">concrete_element_b</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreteElementA</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="n">visitor</span><span class="o">.</span><span class="n">visit_concrete_element_a</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">operation_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;do sth a&quot;</span>

<span class="k">class</span> <span class="nc">ConcreteElementB</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="n">visitor</span><span class="o">.</span><span class="n">visit_concrete_element_b</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">operation_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;do sth b&quot;</span>

<span class="k">class</span> <span class="nc">ObjectStructure</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">ObjectStructure</span><span class="p">()</span>
    <span class="n">o</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">ConcreteElementA</span><span class="p">())</span>
    <span class="n">o</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">ConcreteElementB</span><span class="p">())</span>

    <span class="n">v1</span> <span class="o">=</span> <span class="n">ConcreteVisitor1</span><span class="p">()</span>

    <span class="n">o</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h3>后记</h3>

<ul>
<li>用了4天读完了这本书、虽然说感觉书里面有些例子还是举的太过生硬、但总体来说还是帮助结构化的梳理了之前编程中碰到过的大量例子、两者结合起来才能理解的比较深刻。</li>
<li>我理解学设计模式是学的解耦思想、核心透过几个原则来自己写代码、而不是为了OO而OO的生搬硬套。闭上眼睛想想之前自己的代码到底什么地方设计不合理等等也是可以回味不少的。</li>
<li>这次里面所有的例子我都是用python实现的、其实用python这种活的脚本语言本来就不大适合严谨的设计模式、嘛不过总体来说也是一样的。</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#design pattern-ref">design pattern <span>4</span></a></li>
    
    	<li><a href="#python-ref">python <span>4</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/13/design-pattern-2">Design Pattern (3) </a></h3>
  <div class="date">
    <span>13 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>大话设计模式的读书笔记（三）</h3>

<ul>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-0/">读书笔记（一）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-1/">读书笔记（二）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-3/">读书笔记（四）</a></li>
</ul>

<h3>State, Adapter, Memento, Composite, Singleton</h3>

<h4>状态模式</h4>

<ul>
<li>理解状态核心就是让一个封闭的东西自己决定自己该干嘛、而如何让他自己决定就是给他自己一个状态</li>
<li><p>例如button一个按钮他就有多种状态、而他的行为都是被按上去、由他自己来决定自己要做什么</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">dosth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Pressed</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">dosth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;do sth 1&quot;</span>
      <span class="n">button</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Normal</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">dosth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;do sth 2&quot;</span>
      <span class="n">button</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Pressed</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Button</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">press</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dosth</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">Button</span><span class="p">()</span>
  <span class="n">b</span><span class="o">.</span><span class="n">press</span><span class="p">()</span>
  <span class="n">b</span><span class="o">.</span><span class="n">press</span><span class="p">()</span>
</code></pre></div></li>
</ul>

<h4>适配器模式</h4>

<ul>
<li>adapter的核心是把一些接口不兼容的一些类可以被统一的一起工作</li>
<li>例如在客户端一个page需要展示的格式不止一种、比如他有两个tab通过切换实现两套数据、而具体他们的实现其实并不可以保证接口一定统一这个时候就可以使用adapter</li>
<li>最好的例子就是android的adapter、adapter就起了桥接AdapterView与里面具体data的作用，可以一个Adapter这样的类兼容很多展示工作</li>
<li>同理ios中对一个比较复杂的viewController可以参考android中的adapter模式把里面的多种情况抽离开来在最上层再统一的塞进去、例如拆开tableView等的delegate dataSource进去</li>
</ul>

<h4>备忘录模式</h4>

<ul>
<li>具体定义为不破坏封装性的前提下，不活一个对象的内部状态并可以随时恢复</li>
<li>这个也是用烂了的东西……比如在各种canvas绘图时对各种变量设置的save restore</li>
<li>例如<code>CGContextSaveGState</code>和<code>CGContextRestoreGState</code>这一对api</li>
<li><p>书上的正经的写法是这样的反正我个人认为是极大的不喜欢……感觉纯粹是为了OO而OO的产物</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">Memento</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span> 

<span class="k">class</span> <span class="nc">Originator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="k">def</span> <span class="nf">create_memento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">Memento</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">restoreMemento</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memento</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">memento</span><span class="o">.</span><span class="n">state</span>

<span class="k">class</span> <span class="nc">Caretaker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">memento</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">Originator</span><span class="p">()</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">Caretaker</span><span class="p">()</span>
  <span class="n">c</span><span class="o">.</span><span class="n">memento</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">create_memento</span><span class="p">()</span>
  <span class="n">o</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">o</span><span class="o">.</span><span class="n">restoreMemento</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">memento</span><span class="p">)</span>
</code></pre></div></li>
</ul>

<h4>组合模式</h4>

<ul>
<li>理解的核心就是这就是颗树、然后对上层调用者来说他只关心他、并不关心他下面的节点、比如他不关心他控制的是一个节点还是一棵树</li>
<li>又拿ios做例子了……比如<code>UIView</code>你你根本不用去关系到底这个view只有一层还是有一坨subview……</li>
<li>有一点需要比较注意的就是非常有可能因为这棵树的结构是一样的导致很多相应的节点实现起来会很难受因为很多别的节点的方法自己并没有的。在这里书上其实主要选择两种方法、具体用哪儿种其实我还是倾向透明的好、毕竟调空也没什么问题啦……

<ul>
<li>透明方式 暴露出这些节点方法、具有一致的行为接口、空着去实现</li>
<li>安全方式 不去实现这些方法、在上层调用的时候需要做相应的判断</li>
</ul></li>
</ul>

<h4>迭代器模式</h4>

<ul>
<li>迭代器模式提供了一种方法顺序访问一个聚合对象的各个元素、且不暴露内部</li>
<li>就像python一个list根本其实不需要在意list中每一个到底是什么东西只需要知道我可以一个个的取就够了</li>
<li>这个模式已经甚至进化成语言特性了</li>
</ul>

<h4>单例模式</h4>

<ul>
<li>也是比较用烂的、我其实理解单例就是那些需要类似写面向过程的代码、没办法的通路= =</li>
<li>单例的定义就是保证一个类仅只能又一个实例</li>
<li><p>写一个python的单例</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">def</span> <span class="nf">singleton</span><span class="p">(</span><span class="n">class_</span><span class="p">):</span>
<span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">def</span> <span class="nf">getinstance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">class_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
      <span class="n">instances</span><span class="p">[</span><span class="n">class_</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">instances</span><span class="p">[</span><span class="n">class_</span><span class="p">]</span>
<span class="k">return</span> <span class="n">getinstance</span>

<span class="nd">@singleton</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">BaseClass</span><span class="p">):</span>
<span class="k">pass</span>
</code></pre></div></li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#design pattern-ref">design pattern <span>4</span></a></li>
    
    	<li><a href="#python-ref">python <span>4</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/12/design-pattern-1">Design Pattern (2) </a></h3>
  <div class="date">
    <span>12 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>大话设计模式的读书笔记（二）</h3>

<ul>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-0/">读书笔记（一）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-2/">读书笔记（三）</a></li>
</ul>

<h3>Facade, Builder, Observer, Abstract Factory</h3>

<h4>外观模式</h4>

<ul>
<li>外观模式大概不就是个封装……说好听点他的定义是「为系统中一组接口提供一个一致的界面」核心就是把业务层的复杂逻辑全部抽出来给另外一个替死鬼来干ˊ_&gt;ˋ</li>
<li>代码也不想写了、举个例子比如老师管理收作业要去不会去盯每个学生、会选个班长把脏活都丢给他来做……自己只要简单的去和班长交流就好了</li>
</ul>

<h4>建造者模式</h4>

<ul>
<li>建造者模式我理解核心有一点是强制把一些必须实现的东西抽象到上层通过虚方法强制必须实现。这样可以极大的有效的防止使用的时候漏掉了某一个步骤</li>
<li><p>另外一个是他有一个叫导演的概念、整个建造的方法整段逻辑托管给了这个导演而不会暴露给最上层去担忧这个事情</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
          <span class="k">print</span> <span class="n">i</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">Builder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">build_part_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">build_part_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConcreteBuilder1</span><span class="p">(</span><span class="n">Builder</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">build_part_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;partA&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">build_part_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;partB&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span>

<span class="k">class</span> <span class="nc">Director</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="n">builder</span><span class="p">):</span>
      <span class="n">builder</span><span class="o">.</span><span class="n">build_part_a</span><span class="p">()</span>
      <span class="n">builder</span><span class="o">.</span><span class="n">build_part_b</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">ConcreteBuilder1</span><span class="p">()</span>
  <span class="n">Director</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
  <span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></li>
</ul>

<h4>观察者模式</h4>

<ul>
<li>我想这个东西熟悉ios的人一定不会陌生、ios中kvo的使用简直是不能再棒、那为什么客户端超级适用这个模式我想大家也应该想到了是因为客户端因为是个超级重交互的东西、例如UI层的重新render每次都需要前段手动进行这么一下简直是不能忍的</li>
<li>观察者模式核心的话我认为是一种定义了一个一对N的关系、并且一去和N中的一个进行交互、一旦触发同时去触发剩下另外的N－1个。例如ios的UIVIew会去observe他的rect、一旦这一个rect进行变化、他会自己去触发绑定的一坨逻辑例如render等等</li>
<li><p>写了一个很简单的UI的模拟 rect就简单变成kvo一个int了</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">ISth</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

<span class="k">class</span> <span class="nc">View</span><span class="p">(</span><span class="n">ISth</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_rect</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">rect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect</span>

  <span class="nd">@rect.setter</span>
  <span class="k">def</span> <span class="nf">rect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_rect</span> <span class="o">=</span> <span class="n">value</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="p">:</span>
          <span class="n">i</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;i am render&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">View</span><span class="p">()</span>
  <span class="n">v</span><span class="o">.</span><span class="n">rect</span> <span class="o">=</span> <span class="mi">5</span>
</code></pre></div>
<h4>抽象工厂模式</h4></li>
<li><p>好吧……抽象工厂模式其实就是工厂的再一步进化……核心就是本来子类到底是什么是交给具体适用场景去决定的、而抽象工厂把这部分也给抽走了</p></li>
<li><p>说具体点两者的差别的话就是类似多个route的东西、由他来决定到底把工厂route到哪儿个子类去，然后表示用一坨switch case太丑陋了，然后用了反射来处理、我就大致写下python的反射好了= =具体的工厂大同小异了</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">class_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;xxx&quot;</span><span class="p">)</span>
</code></pre></div></li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#design pattern-ref">design pattern <span>4</span></a></li>
    
    	<li><a href="#python-ref">python <span>4</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/11/design-pattern-0">Design Pattern (1) </a></h3>
  <div class="date">
    <span>11 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>大话设计模式的读书笔记（一）</h3>

<ul>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-1/">读书笔记（二）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-2/">读书笔记（三）</a></li>
<li><a href="http://snorlaxzxz.com/program/2014/10/11/design-pattern-3/">读书笔记（四）</a></li>
</ul>

<h3>Simple Factory, Strategy, Decorator, Factory, Proxy, Prototype, Template</h3>

<h4>简单工厂模式</h4>

<ul>
<li>其实工厂平常也用的非常多了、核心就是抽出公共外部接口、然后按照需求子类、然后由统一工厂返回。好处也很明显就是解耦、隔绝上层知道自己不需要知道的东西。</li>
<li><p>用<code>python</code>实现了一端最简单的例子</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">Operation</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">number_a</span> <span class="o">=</span> <span class="n">a</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">number_a</span> <span class="o">=</span> <span class="n">b</span>
  <span class="c"># 抽象出公共的计算</span>
  <span class="k">def</span> <span class="nf">getresult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;base method must be implement&quot;</span>

<span class="k">class</span> <span class="nc">Add</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">getresult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_b</span>

<span class="k">class</span> <span class="nc">Minus</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">getresult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_a</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_b</span>

<span class="k">class</span> <span class="nc">Factory</span><span class="p">:</span>
  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">create_operation</span><span class="p">(</span><span class="n">operate</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">operate</span> <span class="o">==</span> <span class="s">&quot;+&quot;</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">Add</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">operate</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">Minus</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">op</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create_operation</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">number_a</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">op</span><span class="o">.</span><span class="n">number_b</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="k">print</span> <span class="n">op</span><span class="o">.</span><span class="n">getresult</span><span class="p">()</span>
</code></pre></div>
<h4>策略模式</h4></li>
<li><p>我理解的策略模式其实就是给操作对象多wrap了一层context的东西、由他来抽象一堆方法进行管理。核心也是解耦把这部分脏东西控制在自己手上避免影响到上层</p></li>
<li><p>其实类似<code>NSManagedObjectContext</code>这就是封装了真实数据底层的一些方法、让用户避免开这样噁心的东西、具体不同的数据媒介的相关操作让他自己处理即可。</p></li>
<li><p>同样一个简单的例子、抽象出cash这个类、他的具体打折策略去由context去维护、整个这个打折这个事件全托管给context、类似一个中间人的角色</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">CashSuper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;abstract method must be implement&quot;</span>

<span class="k">class</span> <span class="nc">CashNormal</span><span class="p">(</span><span class="n">CashSuper</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">*</span> <span class="mf">0.9</span>

<span class="k">class</span> <span class="nc">CashRebate</span><span class="p">(</span><span class="n">CashSuper</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">-</span> <span class="mi">300</span>

<span class="k">class</span> <span class="nc">CashContext</span><span class="p">:</span>
  <span class="n">cash_super</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_str</span><span class="p">,</span> <span class="n">money</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">type_str</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">cash_super</span> <span class="o">=</span> <span class="n">CashNormal</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">cash_super</span> <span class="o">=</span> <span class="n">CashRebate</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cash_super</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">money</span>

  <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cash_super</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">cc</span> <span class="o">=</span> <span class="n">CashContext</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
  <span class="k">print</span> <span class="n">cc</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span> 
</code></pre></div>
<h4>装饰模式</h4></li>
<li><p>装饰模式核心就是装饰不要去污染原来的东西、遵循开放封闭原则。例如一个人穿衣服、隔离出穿衣服这个事情。</p></li>
<li><p>先写一端照书上的装饰模式的结构图写的代码</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Finery</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
  <span class="n">person</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">person</span> <span class="o">=</span> <span class="n">person</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">TShirt</span><span class="p">(</span><span class="n">Finery</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;wear tshirt&quot;</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">TShirt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Shoe</span><span class="p">(</span><span class="n">Finery</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;wear shoe&quot;</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">Shoe</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">&quot;zx&quot;</span><span class="p">)</span>
  <span class="n">ts</span> <span class="o">=</span> <span class="n">TShirt</span><span class="p">()</span>
  <span class="n">sh</span> <span class="o">=</span> <span class="n">Shoe</span><span class="p">()</span>

  <span class="n">ts</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
  <span class="n">sh</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
  <span class="n">sh</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></li>
<li><p>感觉这样装饰模式虽然结构清楚、但是写起来感觉很难受、继承来继承去也麻烦、用了另外种装饰方法感觉明了简介更多</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">def</span> <span class="nf">wear_shoe</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;wear shoe&quot;</span>
      <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">wear_tshirt</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;wear Tshirt&quot;</span>
      <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">&quot;zx&quot;</span><span class="p">)</span>
  <span class="n">f</span> <span class="o">=</span> <span class="n">wear_tshirt</span><span class="p">(</span><span class="n">wear_shoe</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">show</span><span class="p">))</span>
  <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<h4>工厂模式</h4></li>
<li><p>工厂其实主要就是工厂的抽象以及实体的抽象2部分、把实体的选择都抽象在工厂里、然后统一由工厂返回</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">AbstractFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

  <span class="nd">@abstractmethod</span>
  <span class="k">def</span> <span class="nf">createFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;abstract method must be implement&quot;</span>

<span class="k">class</span> <span class="nc">Instance1</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;instance1 alloc&quot;</span>

<span class="k">class</span> <span class="nc">Factory1</span><span class="p">(</span><span class="n">AbstractFactory</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">createFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">Instance1</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Instance2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;instance2 alloc&quot;</span>

<span class="k">class</span> <span class="nc">Factory2</span><span class="p">(</span><span class="n">AbstractFactory</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">createFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">Instance2</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">instance</span> <span class="o">=</span> <span class="n">Factory1</span><span class="p">()</span><span class="o">.</span><span class="n">createFactory</span><span class="p">()</span>
</code></pre></div>
<h4>代理模式</h4></li>
<li><p>其实代理模式平常用的非常多、我所认为的核心是有两点</p>

<ul>
<li>隔离开他所需要操作的对象、使用户使用这个对象的方法大大减少保证正确</li>
<li>类似一个callback的感觉在调真实对象时有个地方给你写需要做的别的事情</li>
</ul></li>
<li><p>比如html加载图片时碰到真的图片时都是弄个假的框框再去真的download图片大致套用了写模式</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">ImageNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;abstract method must be implement&quot;</span>

<span class="k">class</span> <span class="nc">ImageRequestProxy</span><span class="p">(</span><span class="n">ImageNetwork</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">ImageRequestProxy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">image_request</span> <span class="o">=</span> <span class="n">ImageRequestNetwork</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;render ui&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">image_request</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ImageRequestNetwork</span><span class="p">(</span><span class="n">ImageNetwork</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;download image&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">ImageRequestProxy</span><span class="p">()</span>
  <span class="n">p</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
</code></pre></div>
<h4>原型模式</h4></li>
<li><p>一个词核心就是拷贝实现一个深拷贝就可以了</p></li>
<li><p>比如js就是个非常经典的原型</p></li>
<li><p>例子就不写了 Orz</p></li>
</ul>

<h4>模版模式</h4>

<ul>
<li><p>模版的话核心也是提出公共部分、在可变的部分抽象出公共接口给具体的实现去实现……各种web框架模版也是用烂了的……</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="k">class</span> <span class="nc">Template</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">dosth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;dosth&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">needsth</span><span class="p">()</span>
  <span class="k">def</span> <span class="nf">needsth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;abstract method must be implement&quot;</span>

<span class="k">class</span> <span class="nc">Detail</span><span class="p">(</span><span class="n">Template</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">needsth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">print</span> <span class="s">&quot;food&quot;</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">Detail</span><span class="p">()</span><span class="o">.</span><span class="n">dosth</span><span class="p">()</span>
</code></pre></div></li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#design pattern-ref">design pattern <span>4</span></a></li>
    
    	<li><a href="#python-ref">python <span>4</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/10/09/clean-git-history">Clean Git History </a></h3>
  <div class="date">
    <span>09 October 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>背景</h3>

<ul>
<li>不当心在git里塞进了几个大的静态文件……导致整个git repo大的无法忍于是开始清理

<ul>
<li>核心的东西是使用<code>filter-branch</code> (好像这玩意是用来的原始意图不是这个= = <a href="https://help.github.com/articles/remove-sensitive-data/">我是传送门</a> </li>
<li>查找大文件部分主要参照<a href="http://naleid.com/blog/2012/01/17/finding-and-purging-big-files-from-git-history">这篇blog</a></li>
</ul></li>
</ul>

<h3>具体的操作三步</h3>

<ul>
<li><p>从git历史里找出大文件</p>

<ul>
<li>对所有文件的sha进行输出 <code>git rev-list --objects --all | sort -k 2 | uniq &gt; allsha.txt</code></li>
<li>排序得到所有打文件列表 </li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">git gc &amp;&amp; git verify-pack -v .git/objects/pack/pack-*.idx | egrep &quot;^\w+ blob\W+[0-9]+ [0-9]+ [0-9]+$&quot; \
| sort -k 3 -n -r \
&gt; bigobjects.txt
</code></pre></div>
<ul>
<li>映射sha值得到所有大文件的path列表</li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">for SHA in `cut -f 1 -d\  &lt; bigobjects.txt`; do
  echo $(grep $SHA bigobjects.txt) $(grep $SHA allsha.txt) | \
  awk &#39;{print $1,$3,$7}&#39; &gt;&gt; bigtosmall.txt
done;
</code></pre></div></li>
<li><p>用filter-branch修改掉历史记录</p>

<ul>
<li>其中的Rakefile 就是在上一步中找寻出来的大文件 这里支持通配符的:)</li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">git filter-branch --force --index-filter \
&#39;git rm --cached --ignore-unmatch Rakefile&#39; \
--prune-empty --tag-name-filter cat -- --al
</code></pre></div>
<ul>
<li>push回主干
<code>git push origin master --force</code></li>
</ul></li>
<li><p>用gc清理</p>

<ul>
<li><code>rm -rf .git/refs/original/</code></li>
<li><code>git reflog expire --expire=now --all</code></li>
<li><code>git gc --prune=now</code></li>
<li><code>git gc --aggressive --prune=now</code></li>
</ul></li>
</ul>

<h4>这次成果成功把.git 从130M成功清理成5M哦耶！</h4>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#git-ref">git <span>1</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/gossip/2014/06/14/four-years-in-dut">Four Years In DUT </a></h3>
  <div class="date">
    <span>14 June 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h4>大一</h4>

<ul>
<li>当初考到dut的初衷或许就其实是一个错误、不过错中对的那一点就是我选择了一个我喜欢的专业、选择到了我的爱好。
说实话这是一个学术氛围浓厚却相对轻技术的地方、但我至少值得庆幸了的是我知道了cippus、加入了软件组、从做的acm开始强化自己的编程能力、从周边了解技术是什么样、至少知道了这条路该怎么走。
这里要感谢lw学长、带我入了门、让我知道这个程序的世界长的是什么样子。
这一年我还跟高中一样、打游戏、写作业、其中一点比较影响的或许应该就是包括所有的作业我都强迫自己不在windows上而用*nix上去实现、也是这点为我打下会努力的去看各种开源的东西的基础吧。</li>
</ul>

<h4>大二</h4>

<ul>
<li>到了大二已经放弃了对大学的一切原有的曾经的憧憬、放弃了上课、开始往技术之路无限的深钻下去。整个大二一整年也应该是我彻底转变的一年。
开始强迫自己看一些很厉害的书、从原理开始自己去写自己去尝试所有各种好玩的东西、学习了python、看到好玩的未知的算法会去实现、看到好玩的网络攻击会去尝试、从最基本最白痴的东西开始写。
想想这些总是和爱好兴趣是密不可分的。</li>
<li>其中穿插着也就是软件组了。其实虽然从大一进入软件组、但是那个时候对这个组其实并没有什么很深的感觉、从现在的角度来回想也的确如此、因为大学就是一个
提供给你资源提供给你自学资源(包括身边的同学)的地方！到了大二小学期、我也成为了软件组组长、我也就开始另一方面的开始锻炼自己梳理讲技术的能力了。开始把这一整年自学到的所有的东西进行了一次
系统的梳理、周周的沙龙把自己的所理解都讲出来、虽然那个时候知道自己很菜、说话也很不流利、但是这或许就是锻炼。也是我又需要感谢cippus的地方。</li>
<li>加入了beannote团队、开始拿自己以前零碎的知识点结合起来、大家一起来合作完成一个东西！也是对我这么一个根本没什么存在感的交上朋友的一个重要所在的！团队的每个成员我都学到了很多很多。</li>
<li>其中一小段给老师打工的经历、现在想想也是帮助我认清这个世界的大部分人对编程的态度、对自己的编程能力从玩玩到真的写出来点什么的过度吧。当然也不想黑什么自己得没得到自己该得到的什么、毕竟当时
的自己只是一个外包的员工罢了。</li>
</ul>

<h4>大三上</h4>

<ul>
<li>大三或许就是大二的一个延续、开始把上层虚的东西从底层开始更加务实，结合给新招进来大一的组员的技术例会、同时巩固自己的基础水平。从一个组长的角度来说我觉得我挺失败的，个人认为还是挺失败的
、虽然说我努力的准备着每次技术沙龙、试着从最底层也是最不抽象的东西去开始解释一切一切、但是也或许是过份的枯燥没有培养出大一新生对编程的爱、也导致后文会说到的结果吧……
大三下然后为了开始实习，开始刷codeforces开始看算法导论，开始系统的完整填备这一个空缺。开始投简历、开始面试……</li>
</ul>

<h4>百度</h4>

<ul>
<li>六月份开始去百度知道实习、当时的我应该还是比较迷茫的或许想什么都没有想好、反正就是想着baidu也算bat一家而且也是开发ios、虽然我比较厌恶baidu但也算对口就去实习玩玩吧。心态导致结果，所有人都说的百度苦我没感受到
说到的baidu技术强我也没感受到、唯一真真切切感受到的或许就是一整套敏捷的软件工程的流程。这一点在质量保证上等等或许还是很有用的、但是总是感觉付出远大于结果。当然在大厂来说安全稳定性才是最重要的那也是毋庸置疑的。
其实我一直不喜欢加班、更加讨厌baidu这种快到晚上才开始干活然后看起来是加班加的累死累活的这种状态。我也算是经过两次小黑屋封闭开发，也过了一整个月六天工作的过来，但就算在这种情况下我还是认为效率的极其低下的。
然后到了10月份我离职了、我应该换一家去看看。</li>
<li>去北京待了三四个月就除了中关村那一块都没出去过别的地方简直没救了……</li>
</ul>

<h4>火花</h4>

<ul>
<li>离职之后我在北京的国家图书馆泡了半个月，继续去看书、写程序去接触更多的东西、一点就是继续去投简历了。当时的想法就是要么去做游戏要么继续互联网公司。也的确我都拿到了盛大和火花的offer。
去盛大转了一圈或许这个地方还是不适合我吧。也让我大概断了自己去做游戏的最后跟信念吧、然后就开始加入了火花。</li>
<li>小公司、真的很棒。说实话个人感觉百度的将近4个月可能真的还比不上在这的半个月学到的多，在这我知道了什么叫做不浪费时间、整天的满负荷工作，当除了开发工作包括各种其他在百度都需要向老大请示的所有细节
你都可以自己去决定，从第一天开始我就需要根据当前架构独立写一个东西出来，从整个项目的估期到全部所有的决定权都在作为owner的你手上。这种环境下的成长是非常可怕的。记得第一个月吧每天都是电脑回家写到一两点、
但是不会觉得什么因为能够真切感受到自己的水平在飞速的提升。小公司甚至后端工程师会帮你写几个data model，前端工程师会去commit几个接口。没有那一套代码权限有的就是每一个project的owner的存在。这种感觉我觉得是一个喜欢
写代码的人应该经历过一次的至少我觉得。当然还有朋友、在一个比家人在一起都多的朋友的圈里、才可以开心的做自己喜欢去做的事情。毕业季最伤感的或许也有一点是离开的火花吧。</li>
</ul>

<h4>软件组</h4>

<ul>
<li>从大一的在这里很不错、到大二的在这里是为了我可以自由做我想做的事情的地方、到大三这是一份责任、到现在有一丝愧疚。我觉得我还是一个失败的组长，摸着良心我努力尽力了、换言之我不是一个合格的育人者。但是我相信
我自己的眼光、现在这几个大二的同学我更会相信你们是会变的很厉害的！看着基友组网络更觉得愧疚Orz。
<del>没人想看着中心差下去的或许是不是该有点从能培养出强人的模式里去借鉴什么呢？</del></li>
</ul>

<h4>班级</h4>

<ul>
<li>有时候感觉对我来说、寝室只是个睡觉的地方。想想为什么造成的或许也应该主要是自己的原因。其实想想也挺对不起自己寝室的人的、大一的时候带他们去网吧去玩游戏、却从没考虑他们是否是能够自己收的了的问题。
慢慢的一种恶性循环开始。我也要挺感谢dp的至少能够包容我。</li>
<li>从来我就不是个好人也多谢班级各种帮我擦屁股的同学，也是能够让我混到各种学分的关键。很多人、也许大概我不说话、但心里会说句谢谢！</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#gossip-ref">
    		gossip <span>5</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#dut-ref">dut <span>1</span></a></li>
    
    	<li><a href="#cippus-ref">cippus <span>1</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<!-- </ul> -->

<div id="post-pagination" class="paginator">

  
    <span class="previous disabled">前页</span>
  

      
      <span class="current-page">1</span>
      

    
      
      <a href="/page2">2</a>
      
    
      
      <a href="/page3">3</a>
      
    
      
      <a href="/page4">4</a>
      
    
      
      <a href="/page5">5</a>
      
    
      
      <a href="/page6">6</a>
      
    
      
      <a href="/page7">7</a>
      
    

  
    <a class="next" href="/page2">后页</a>
  
  (共64篇)
</div>

        </div>
        <hr>
        <footer>
          <p>&copy; 2015 Xinzheng ZhangPowered by Jekyll @ GitHub
          </p>
        </footer>

      </div>
    </div>
    
  </body>
</html>

