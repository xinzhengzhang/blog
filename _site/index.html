
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>snorlax's Homepage</title>
    
    <meta name="author" content="Xinzheng Zhang">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments.css?body=1" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Snorlax's blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archives</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




          </ul>
        </div>
      </div>
    </div>
    <div class="container_wrapper">
      <div class="container-narrow">
        <div class="content">
          <!-- <ul class="listing"> -->

<div class="page-header">
  <h3><a href="/%E7%9E%8E%E5%86%99%E5%86%99/2014/05/30/clearance">毕业贩卖 </a></h3>
  <div class="date">
    <span>30 May 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>毕业甩卖</h3>

<h4>EggPlus</h4>

<ul>
<li><strong>出售：60</strong></li>
<li>附赠金龙鱼大豆油 900ml一瓶</li>
<li>附赠清洗工具</li>
<li>渠道 <a href="http://www.mygeek.cn/product/Pro1721.Html">http://www.mygeek.cn/product/Pro1721.Html</a></li>
<li>原价 120</li>
<li><img src="/assets/static/2014-05-30-2.jpg" alt="eggplus"></li>
</ul>

<h4>电风扇</h4>

<ul>
<li><strong>出售：25</strong>
<img src="/assets/static/2014-05-30-3.jpg" alt="fan"></li>
</ul>

<h4>显示器</h4>

<ul>
<li><strong><del>出售：300</del></strong></li>
<li>19寸</li>
<li>分辨率 1440*900</li>
<li>渠道 <a href="http://item.jd.com/172532.html">http://item.jd.com/172532.html</a></li>
<li>原价 699</li>
<li>图为高度和13寸本的对比</li>
<li><img src="/assets/static/2014-05-30-1.jpg" alt="13寸笔记本的对比">
*
<strong>ps. 造福学弟，最好支付宝交易</strong>
<a href="mailto:zhangxzheng@gmail.com">Email</a></li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#瞎写写-ref">
    		瞎写写 <span>5</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/05/27/migrate-blog-from-wp-to-gp">wordpress迁移github page </a></h3>
  <div class="date">
    <span>27 May 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <h3>工作</h3>

<ol>
<li>host在github上</li>
<li>安装jekyll bootstrap <del>简称jb</del></li>
<li>导出wordpress评论以及内容</li>
<li>处理wordpress的内容转化为markdown</li>
<li>注意事项</li>
</ol>

<h4>host在github上</h4>

<ol>
<li><a href="https://pages.github.com/">https://pages.github.com/</a></li>
<li>新建一个username.github.io的repo</li>
<li><a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages">绑定域名</a></li>
</ol>

<h4>安装 jb</h4>

<ol>
<li><a href="http://jekyllbootstrap.com/">http://jekyllbootstrap.com/</a></li>
<li>安装jekyll</li>
<li>clone代码 并看一下sample的样例以及api</li>
</ol>

<hr>

<h4>导出wordpress评论以及内容</h4>

<ul>
<li>导出评论

<ul>
<li>由于github page采用的是纯静态的、评论这种那么麻烦的东西索性还是交给第三方好啦= =在github上我使用的是<a href="http://disqus.com/">disqus</a>，他也同时提供从wordpress导出的功能</li>
<li>创建 disqus账号 <disqus.com/admin/create></li>
<li>添加自己的site并安装wp插件 <a href="http://wordpress.org/plugins/disqus-comment-system/">http://wordpress.org/plugins/disqus-comment-system/</a></li>
<li>等待disques后台进程帮你抓完会通知你的</li>
</ul></li>
<li>导出内容

<ul>
<li>导出content 使用wordpress的导出工具导出xml即可</li>
</ul></li>
</ul>

<h4>转换内容</h4>

<ul>
<li>导出mark down

<ul>
<li><del>jekyll 有一个jekyll-import 的工具、不过中文支持的巨差无比</del></li>
<li>使用一个改进过对中文支持的版本 <a href="https://gist.github.com/chitsaou/1394128">https://gist.github.com/chitsaou/1394128</a></li>
<li>导出的xml命名 (wordpress.xml) 如下命令会把为你生成一拖post 以及wordpress中的page
<code>ruby
ruby -r &quot;./wordpressdotcom.rb&quot; -e &quot;Jekyll::WordpressDotCom.process&quot;
</code></li>
<li>如果在wordpress中没有使用什么插件类似<strong>codebox</strong>这样的到这一步就导入成功了</li>
<li>如果使用了一些奇怪的语法在html用插件解出来的格式就一塌糊涂了，比如我的所有的代码都是用codebox的……
写了一段简单的脚本来处理html，基本思路都是文本解析到codebox的开始标签pre然后替换掉</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;zhangxinzheng&#39;</span>
    <span class="c"># -*- coding: utf-8 -*-</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;html&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">targetName</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;html&quot;</span><span class="p">,</span><span class="s">&quot;md&quot;</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r+&quot;</span><span class="p">)</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
        <span class="k">while</span> <span class="nb">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;&lt;pre&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">tempString</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">```</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">isContent</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">startIndex</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;&lt;pre&quot;</span><span class="p">)</span>
            <span class="n">endIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">realEnd</span> <span class="o">=</span> <span class="n">startIndex</span>
            <span class="n">leftCount</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">rightCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">startIndex</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
                    <span class="n">isContent</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">leftCount</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">isContent</span><span class="p">:</span>
                    <span class="n">tempString</span><span class="o">+=</span><span class="nb">str</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span>
                    <span class="n">isContent</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">rightCount</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="n">realEnd</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">if</span> <span class="n">leftCount</span> <span class="o">==</span> <span class="n">rightCount</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="nb">str</span><span class="o">+=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">```</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="nb">str</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">startIndex</span><span class="p">:</span><span class="n">realEnd</span><span class="p">],</span> <span class="n">tempString</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">targetName</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div>
<h4>注意事项</h4>

<ol>
<li>中文路径在github上跑起来没问题，但是本地调试时会报错</li>
</ol>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="sx">% LANG=&quot;en_US.UTF-8&quot; </span><span class="no">LC_ALL</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span> <span class="n">be</span> <span class="n">jekyll</span> <span class="n">build</span> <span class="o">--</span><span class="n">trace</span>
    <span class="no">Configuration</span> <span class="ss">file</span><span class="p">:</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="n">beyondalbert</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">_config</span><span class="o">.</span><span class="n">yml</span>
                <span class="ss">Source</span><span class="p">:</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="n">beyondalbert</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span>
           <span class="ss">Destination</span><span class="p">:</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="n">beyondalbert</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">_site</span>
          <span class="no">Generating</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">121</span><span class="ss">:in</span> <span class="sb">`gsub!&#39;: invalid byte sequence in US-ASCII (ArgumentError)</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll.rb:121:in `</span><span class="n">sanitized_path</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/post.rb:276:in `destination&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">cleaner</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">43</span><span class="ss">:in</span> <span class="sb">`block in new_files&#39;</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/site.rb:420:in `</span><span class="n">block</span> <span class="p">(</span><span class="mi">2</span> <span class="n">levels</span><span class="p">)</span> <span class="k">in</span> <span class="n">each_site_file</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/site.rb:419:in `each&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">site</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">419</span><span class="ss">:in</span> <span class="sb">`block in each_site_file&#39;</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/site.rb:418:in `</span><span class="n">each</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/site.rb:418:in `each_site_file&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">cleaner</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">43</span><span class="ss">:in</span> <span class="sb">`new_files&#39;</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/cleaner.rb:24:in `</span><span class="n">obsolete_files</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/cleaner.rb:15:in `cleanup!&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">site</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">255</span><span class="ss">:in</span> <span class="sb">`cleanup&#39;</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/site.rb:44:in `</span><span class="n">process</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/command.rb:43:in `process_site&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">46</span><span class="ss">:in</span> <span class="sb">`build&#39;</span>
<span class="sb">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/commands/build.rb:30:in `</span><span class="n">process</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/Documents/Github/jekyll/lib/jekyll/commands/build.rb:17:in `block (2 levels) in init_with_program&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/.</span><span class="n">rbenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">mercenary</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mercenary</span><span class="o">/</span><span class="n">command</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">220</span><span class="ss">:in</span> <span class="sb">`call&#39;</span>
<span class="sb">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/mercenary-0.3.3/lib/mercenary/command.rb:220:in `</span><span class="n">block</span> <span class="k">in</span> <span class="n">execute</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/mercenary-0.3.3/lib/mercenary/command.rb:220:in `each&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/.</span><span class="n">rbenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">mercenary</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mercenary</span><span class="o">/</span><span class="n">command</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">220</span><span class="ss">:in</span> <span class="sb">`execute&#39;</span>
<span class="sb">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/mercenary-0.3.3/lib/mercenary/program.rb:35:in `</span><span class="n">go</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/mercenary-0.3.3/lib/mercenary.rb:22:in `program&#39;</span>
        <span class="n">from</span> <span class="sr">/Users/</span><span class="n">albertogg</span><span class="o">/</span><span class="no">Documents</span><span class="o">/</span><span class="no">Github</span><span class="o">/</span><span class="n">jekyll</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="ss">jekyll</span><span class="p">:</span><span class="mi">18</span><span class="ss">:in</span> <span class="sb">`&lt;top (required)&gt;&#39;</span>
<span class="sb">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/bin/jekyll:23:in `</span><span class="nb">load</span><span class="s1">&#39;</span>
<span class="s1">        from /Users/albertogg/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/bin/jekyll:23:in `&lt;main&gt;&#39;</span>
    <span class="sb">```</span>
<span class="sb">  * 详见这个&lt;https://github.com/jekyll/jekyll/issues/2379&gt; 修改了报错那行为</span>
<span class="sb">  ```</span><span class="n">ruby</span>
    <span class="n">clean_path</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\A\w\:\//</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>使用里面的代码高亮很不爽可以参见gfm使用他的语法并在config中调整配置
<code>
markdown: redcarpet
redcarpet:
  extensions: [&quot;no_intra_emphasis&quot;, &quot;fenced_code_blocks&quot;, &quot;autolink&quot;, &quot;strikethrough&quot;, &quot;superscript&quot;]
</code></li>
<li>代码高亮开启了pygments后的css也需要自己配置来写

<ul>
<li>可以参加<a href="https://github.com/richleland/pygments-css">https://github.com/richleland/pygments-css</a></li>
</ul></li>
</ol>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#wordpress-ref">wordpress <span>1</span></a></li>
    
    	<li><a href="#github-ref">github <span>1</span></a></li>
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/03/06/tableview%E4%B8%8A%E6%BB%91%E5%8A%A8%E6%97%B6%E7%9A%84navigation%20bar%E7%9A%84%E9%81%AE%E7%BD%A9">tableview上滑动时的navigation bar的遮罩 </a></h3>
  <div class="date">
    <span>06 March 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>这个需求本来并不复杂、烦人的几乎这端遮罩代码要复用到每个tablview所在的场景、非常的不合适、直到看到了前辈写的一段hack到暴的代码才深知道所在的差距……
他大致的思路就是给scrollview拓展了一个category、利用ios的运行时的特性、在他load的时候直接把他的setContenOffset给替换掉成了自己的函数、用他来控制公共的navigationbar
代码如下</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="k">@interface</span> <span class="nc">UIScrollView</span> <span class="nl">(ContentOffset)</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">load</span><span class="p">;</span> <span class="c1">//复写掉load方法</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">UIScrollView</span> <span class="nl">(ContentOffset)</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">load</span>
<span class="p">{</span>
    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="n">setContentOffset</span><span class="o">:</span><span class="p">)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="n">swizzled_setContentOffset</span><span class="o">:</span><span class="p">)));</span><span class="c1">//替换原生的与自己重写的</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">swizzled_setContentOffset:</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">)</span><span class="nv">point</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="n">swizzled_setContentOffset</span><span class="o">:</span><span class="n">point</span><span class="p">];</span><span class="c1">//由于此时已经被交换了所以调用自己相当于是在调原生的setContOffset</span>

    <span class="n">ZDDeckViewManager</span> <span class="o">*</span><span class="n">deck</span> <span class="o">=</span> <span class="p">[</span><span class="n">ZDDeckViewManager</span> <span class="n">sharedInstance_ks</span><span class="p">];</span><span class="c1">//单例拿到大家一起控制的navigationbar</span>
    <span class="cm">/*这里就可以在滑动状态上对bar做任何事情了*/</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/03/05/%E6%9C%AA%E5%BC%95%E7%94%A8%E5%9B%BE%E7%89%87%E5%88%A0%E9%99%A4">未引用图片删除 </a></h3>
  <div class="date">
    <span>05 March 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>同理可以用来处理些别的资源文件</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nv">PROJ</span><span class="o">=</span><span class="sb">`</span>find . -name <span class="s1">&#39;*.xib&#39;</span> -o -name <span class="s1">&#39;*.[mh]&#39;</span><span class="sb">`</span>

<span class="k">for </span>png in <span class="sb">`</span>find . -name <span class="s1">&#39;*.png&#39;</span> <span class="p">|</span> grep -v @2x<span class="sb">`</span> <span class="c">#所要处理的资源文件类型</span>
<span class="k">do</span>
<span class="k">    </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$png</span><span class="sb">`</span>
    <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$name</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/\.png//g&#39;</span><span class="sb">`</span>  <span class="c">#在代码中的表现形势、如果有一些拼串的需要特殊处理</span>
    <span class="k">if</span> ! grep -qhs <span class="nv">$name</span> <span class="nv">$PROJ</span><span class="p">;</span> <span class="k">then</span>
<span class="k">        </span><span class="nv">tmp</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$png</span> <span class="p">|</span> grep /Zhidao/Resources/Image <span class="p">|</span> grep -v /Image/Professional/<span class="sb">`</span> <span class="c">#排除一些不想处理的文件架比如引用外部封完的东西的</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$tmp&quot;</span> <span class="o">=</span> <span class="s2">&quot;$png&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;$png is not referenced&quot;</span>
<span class="c">#           svn rm $png</span>
<span class="c">#           doubleName=`echo $png | sed -e &#39;s/\.png/@2x\.png/g&#39;`</span>
<span class="c">#           svn rm $doubleName@</span>

        <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">done</span>
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2014/02/03/%E5%85%B3%E4%BA%8Ensurlsessiondownloadtask%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92">关于NSURLSessionDownloadTask的参数传递 </a></h3>
  <div class="date">
    <span>03 February 2014</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>ios7开放了一组新的api其中一个最吸引人的也应该就是开放了后台下载的接口。当然凭ios一贯的作风肯定是把接口封的简单的要死然后用着噁心的要死……反正我是绝对被噁心到了、最近要解决的一个问题就是把downloadtask和实体关联上的问题。当然最简单的就是传参数了，然后我可以很负责的告诉你……尼玛你assign task的时候和从call back拿的时候不是一个实体！！！wtf……所以什么用runtime给他加点奇怪的东西什么都别想了……<br />
-------------------------------------------万恶的分割线-----------------------------------------------<br />
然后就说下解决办法吧……其实想想是会吐血的，仔细看看他的.h里面终于发现了还有这个一个东西……至少他是不会变的……<br />
所以我们既然找到了有不变的东西那么就终于可以有解决办法了……直接把要传的东西转成json靠这个东西传简直轻松又愉快……</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="cm">/*</span>
<span class="cm"> * The taskDescription property is available for the developer to</span>
<span class="cm"> * provide a descriptive label for the task.</span>
<span class="cm"> */</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">taskDescription</span><span class="p">;</span>
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2013/07/30/%E5%9C%86%E5%BD%A2%E5%B8%83%E5%B1%80%E7%9A%84icon%E9%A1%B5%E9%9D%A2-loading%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C">圆形布局的icon页面 loading动画效果 </a></h3>
  <div class="date">
    <span>30 July 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><a href="http://snorlax-wordpress.stor.sinaapp.com/uploads/2013/07/700BAD52-7C3F-4500-8B52-69C13291528D.jpg"><img src="http://snorlax-wordpress.stor.sinaapp.com/uploads/2013/07/700BAD52-7C3F-4500-8B52-69C13291528D.jpg" alt="" title="700BAD52-7C3F-4500-8B52-69C13291528D" width="314" height="470" class="alignnone size-full wp-image-397" /></a>
大致效果就是3个元素根据不同时间间隔开始沿着圆进行无限追逐，每次一圈后进行一个小停顿然后继续、比较类似wp7的那种小的loading、主要用到的还是CAKeyframeAnimation其中为了让无限循环中加上停顿用了个小trick
</p>
<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="cp">#import &lt;QuartzCore/QuartzCore.h&gt;</span>
<span class="cp">#define PI 3.14159265358979323846</span>
<span class="k">@interface</span> <span class="nc">canvas</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">UIButton</span> <span class="o">*</span><span class="n">red</span><span class="p">;</span>
    <span class="n">UIButton</span> <span class="o">*</span><span class="n">green</span><span class="p">;</span>
    <span class="n">UIButton</span> <span class="o">*</span><span class="n">yellow</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">canvas</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span>
<span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">initWithFrame</span><span class="o">:</span><span class="n">frame</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Initialization code</span>
        <span class="n">red</span><span class="o">=</span><span class="p">[[</span><span class="n">UIButton</span> <span class="n">alloc</span><span class="p">]</span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">117.55</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">38.1</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
        <span class="n">green</span><span class="o">=</span><span class="p">[[</span><span class="n">UIButton</span> <span class="n">alloc</span><span class="p">]</span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">141.42</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">58.57</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
        <span class="n">yellow</span><span class="o">=</span><span class="p">[[</span><span class="n">UIButton</span> <span class="n">alloc</span><span class="p">]</span><span class="n">initWithFrame</span><span class="o">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mf">173.2</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
        <span class="p">[</span><span class="n">red</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">green</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">greenColor</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">yellow</span> <span class="n">setBackgroundColor</span><span class="o">:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">yellowColor</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">red</span> <span class="n">addTarget</span><span class="o">:</span><span class="n">self</span> <span class="n">action</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>
        <span class="p">[</span><span class="n">yellow</span> <span class="n">addTarget</span><span class="o">:</span><span class="n">self</span> <span class="n">action</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="n">forControlEvents</span><span class="o">:</span><span class="n">UIControlEventTouchUpInside</span><span class="p">];</span>

        <span class="p">[</span><span class="n">self</span> <span class="n">start</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">red</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">green</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">addSubview</span><span class="o">:</span><span class="n">yellow</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">end</span><span class="p">{</span>
    <span class="p">[</span><span class="n">red</span><span class="p">.</span><span class="n">layer</span> <span class="n">removeAllAnimations</span><span class="p">];</span>
    <span class="p">[</span><span class="n">green</span><span class="p">.</span><span class="n">layer</span> <span class="n">removeAllAnimations</span><span class="p">];</span>
    <span class="p">[</span><span class="n">yellow</span><span class="p">.</span><span class="n">layer</span> <span class="n">removeAllAnimations</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">start</span><span class="p">{</span>
    <span class="n">CGMutablePathRef</span> <span class="n">path</span><span class="o">=</span><span class="n">CGPathCreateMutable</span><span class="p">();</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8424</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8424</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="p">,</span> <span class="nb">NO</span><span class="p">);</span><span class="c1">//用cgpath画出运动轨迹</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8424</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9424</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
    <span class="n">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">animation</span><span class="o">=</span><span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="n">animationWithKeyPath</span><span class="o">:</span><span class="s">@&quot;position&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setCalculationMode</span><span class="o">:</span><span class="n">kCAAnimationPaced</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setPath</span><span class="o">:</span><span class="n">path</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setDuration</span><span class="o">:</span><span class="mf">2.0f</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setTimingFunction</span><span class="o">:</span><span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="n">functionWithName</span><span class="o">:</span><span class="n">kCAMediaTimingFunctionEaseInEaseOut</span><span class="p">]];</span>
<span class="c1">//    [animation setBeginTime:CACurrentMediaTime()+0.7];</span>
<span class="c1">//    [animation setRepeatCount:HUGE_VALF];</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="n">CAAnimationGroup</span> <span class="o">*</span><span class="n">animationGroup</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAAnimationGroup</span> <span class="n">animation</span><span class="p">];</span><span class="c1">//利用动画组的间隔做到小动画的无限间隔之间的停顿</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">repeatCount</span> <span class="o">=</span> <span class="n">INFINITY</span><span class="p">;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">animations</span><span class="o">=</span><span class="p">@[</span><span class="n">animation</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animationGroup</span> <span class="n">setBeginTime</span><span class="o">:</span><span class="n">CACurrentMediaTime</span><span class="p">()</span><span class="o">+</span><span class="mf">0.5</span><span class="p">];</span><span class="c1">//让三个元素起始时间区分开</span>
    <span class="p">[</span><span class="n">red</span><span class="p">.</span><span class="n">layer</span> <span class="n">addAnimation</span><span class="o">:</span><span class="n">animationGroup</span> <span class="n">forKey</span><span class="o">:</span><span class="nb">NULL</span><span class="p">];</span>
    <span class="n">path</span><span class="o">=</span><span class="n">CGPathCreateMutable</span><span class="p">();</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.683</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.683</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="p">,</span> <span class="nb">NO</span><span class="p">);</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.683</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.783</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
    <span class="n">animation</span><span class="o">=</span><span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="n">animationWithKeyPath</span><span class="o">:</span><span class="s">@&quot;position&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setCalculationMode</span><span class="o">:</span><span class="n">kCAAnimationPaced</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setPath</span><span class="o">:</span><span class="n">path</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setDuration</span><span class="o">:</span><span class="mf">2.0f</span><span class="p">];</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setTimingFunction</span><span class="o">:</span><span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="n">functionWithName</span><span class="o">:</span><span class="n">kCAMediaTimingFunctionEaseInEaseOut</span><span class="p">]];</span>
<span class="c1">//    [animation setBeginTime:CACurrentMediaTime()+0.5];</span>
<span class="c1">//    [animation setRepeatCount:HUGE_VALF];</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="n">animationGroup</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAAnimationGroup</span> <span class="n">animation</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">repeatCount</span> <span class="o">=</span> <span class="n">INFINITY</span><span class="p">;</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">animations</span><span class="o">=</span><span class="p">@[</span><span class="n">animation</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="p">[</span><span class="n">animationGroup</span> <span class="n">setBeginTime</span><span class="o">:</span><span class="n">CACurrentMediaTime</span><span class="p">()</span><span class="o">+</span><span class="mf">0.2</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="p">[</span><span class="n">green</span><span class="p">.</span><span class="n">layer</span> <span class="n">addAnimation</span><span class="o">:</span><span class="n">animationGroup</span> <span class="n">forKey</span><span class="o">:</span><span class="nb">NULL</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">path</span><span class="o">=</span><span class="n">CGPathCreateMutable</span><span class="p">();</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.425</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.425</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="p">,</span> <span class="nb">NO</span><span class="p">);</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">CGPathAddArc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.425</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.525</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="n">animation</span><span class="o">=</span><span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="n">animationWithKeyPath</span><span class="o">:</span><span class="s">@&quot;position&quot;</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setCalculationMode</span><span class="o">:</span><span class="n">kCAAnimationPaced</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setPath</span><span class="o">:</span><span class="n">path</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="p">[</span><span class="n">animation</span> <span class="n">setDuration</span><span class="o">:</span><span class="mf">2.0f</span><span class="p">];</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<span class="c1">//    [animation setRepeatCount:HUGE_VALF];&lt;/p&gt;</span>

    <span class="p">[</span><span class="n">animation</span> <span class="n">setTimingFunction</span><span class="o">:</span><span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="n">functionWithName</span><span class="o">:</span><span class="n">kCAMediaTimingFunctionEaseInEaseOut</span><span class="p">]];</span>

    <span class="n">CFRelease</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="n">animationGroup</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAAnimationGroup</span> <span class="n">animation</span><span class="p">];</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">repeatCount</span> <span class="o">=</span> <span class="n">INFINITY</span><span class="p">;</span>
    <span class="n">animationGroup</span><span class="p">.</span><span class="n">animations</span><span class="o">=</span><span class="p">@[</span><span class="n">animation</span><span class="p">];</span>
    <span class="p">[</span><span class="n">yellow</span><span class="p">.</span><span class="n">layer</span> <span class="n">addAnimation</span><span class="o">:</span><span class="n">animationGroup</span> <span class="n">forKey</span><span class="o">:</span><span class="nb">NULL</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Only override drawRect: if you perform custom drawing.</span>
<span class="c1">// An empty implementation adversely affects performance during animation.</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span>
<span class="p">{</span>
    <span class="n">CGContextRef</span> <span class="n">context</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
    <span class="n">CGContextSetStrokeColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
    <span class="n">CGContextAddArc</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>

    <span class="p">[[</span><span class="n">UIColor</span> <span class="n">orangeColor</span><span class="p">]</span> <span class="n">setFill</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">setStroke</span><span class="p">];</span>
    <span class="n">CGContextDrawPath</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">kCGPathStroke</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2013/07/29/ios%E6%9B%BF%E6%8D%A2%E7%B3%BB%E7%BB%9F%E6%96%B9%E6%B3%95">ios替换系统方法 </a></h3>
  <div class="date">
    <span>29 July 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>作为动态语言的oc我以前一直忽视了他的动态特性最近一个分享会才突然就有种飘逸的感觉<br />
主要使用的就是oc的runtime特性<br /></p>

<h1>import &quot;objc/runtime.h&quot;<br /></h1>

<p>引入这个头文件之后才发现动态远远不止我以前想的那么简单引入这个头文件后可以发现者真是海量的api能让代码写的真是自己都不认识都不过分<br />
然后就写一个例子来试验了<br />
比如 NSArray 里面的objetAtIndex 方法我想这个方法真是被无数人深恶痛绝……多少crash都是从这里搞出来的啊那么其实通过runtime完全可以重写这个方法、当然绝对不仅仅是简单的给他封一层那么简单<br />
首先你先需要找到这个方法是在哪儿的、最简单的方法就是故意越界让他报次错看看嘛Terminating app due to uncaught exception &#39;NSRangeException&#39;, reason: &#39;*** -[__NSArrayI objectAtIndex:]<br />
看到了吧就是 _NSArrayI里<br />
然后需要做的就是很简单了</p>

<p>Method method_ObjectAtIndex = class_getInstanceMethod(NSClassFromString(@&quot;_<em>NSArrayI&quot;),@selector(objectAtIndex:));
Method method_SafeObjectAtIndex = class_getInstanceMethod(NSClassFromString(@&quot;NSArray&quot;),@selector(safeObjectAtIndex:));//这个方法就是一会自己写的拓展进nsarray中的
method_exchangeImplementations(method</em>ObjectAtIndex, method_SafeObjectAtIndex);//然后交换就是这么简单 不过这个危险性也是极大的比如整个系统所有的调用这个原生api的调用就全都走到你这来了、必须必须要确保正确性……</p>

<p>//然后就简单的加个category的实现就好了
@implementation NSArray(SafeExtenstion)
- (id)safeObjectAtIndex:(NSUInteger)index
{
    NSLog(@&quot;wake %@--%@&quot;,NSStringFromSelector(_cmd),self);
    if (self.count 
    return [self safeObjectAtIndex:index];
}
@end</p>

<p>这样就可以自己去复写掉一些认为系统实现的很傻逼的方法了吧、runtime的适用场景我想还远远不止这些呢</p>

<blockquote>
</blockquote>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2013/06/24/%E5%AE%9A%E5%88%B6-uipagecontrol">定制 UIPageControl </a></h3>
  <div class="date">
    <span>24 June 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>pagecontrol 就是iphone上面比如scrollview翻图片时候下面那个小点点<br />
其实我个人觉得还是挺美观的……可是需求就是要自己的图片替掉……然后死人苹果又不给api、所以也就只能自己复写实现了<br />
先说下ios7之前 那些点点的实现非常简单 就是UIPageControl.subviews 就是一个个点的UIImageView 所以只需简单的替换掉就好了代码如下</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@property(nonatomic,strong)UIImage *_activeImage;
@property(nonatomic,strong)UIImage *_inactiveImage;
//在init的时候把你自己定义的两张图片搞进去
- (void)updateDots
{
    for (int i = 0; i

        if (i == self.currentPage) {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_activeImage;
            }

        } else {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_inactiveImage;
            }
        }
    }
}
//然后自己重载一下setNumber就好了

- (void)setNumberOfPages:(NSInteger)numberOfPages
{
    [super setNumberOfPages:numberOfPages];
    [self updateDots];
}

但是呢万恶的ios7改掉了尼玛……连底层实现都改啊混蛋……可以对self.subviews 标红一下就明白了……整个pagecontrol的uivew乱七八糟……而且都是view根本就没了image属性、换句话说现在的那些小点点都是代码写出来的了、而不是简单图了
实现起来就要重写UIView的绘画函数了代码大致如下

#import &quot;ZDPageControll.h&quot;
#import 

@interface ZDPageControll()
{
    UIImage *_activeImage;
    UIImage *_inactiveImage;
    NSArray *_usedToRetainOriginalSubview;
}

@end

@implementation ZDPageControll
@synthesize kSpacing=_kSpacing;
- (id)initWithFrame:(CGRect)frame currentImageName:(NSString *)current commonImageName:(NSString *)common
{
    self= [super initWithFrame:frame];
    if ([self respondsToSelector:@selector(setCurrentPageIndicatorTintColor:)] &amp;&amp; [self respondsToSelector:@selector(setPageIndicatorTintColor:)]) {
        [self setCurrentPageIndicatorTintColor:[UIColor clearColor]];
        [self setPageIndicatorTintColor:[UIColor clearColor]];
    }

    [self setBackgroundColor:[UIColor clearColor]];
    _activeImage= [UIImage imageNamed:current];
    _inactiveImage= [UIImage imageNamed:common];
    _kSpacing=10.0f;
    //hold住原来pagecontroll的subview
    _usedToRetainOriginalSubview=[NSArray arrayWithArray:self.subviews];
    for (UIView *su in self.subviews) {
        [su removeFromSuperview];
    }
    self.contentMode=UIViewContentModeRedraw;
    return self;
}
-(void)dealloc
{
    //释放原来hold住的那些subview
    _usedToRetainOriginalSubview=nil;
    _activeImage=nil;
    _inactiveImage=nil;
}
- (void)updateDots
{

    for (int i = 0; i
        UIImageView* dot =[self.subviews objectAtIndex:i];

        if (i == self.currentPage) {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_activeImage;
            }

        } else {
            if ([dot respondsToSelector:@selector(setImage:)]) {
                dot.image=_inactiveImage;
            }
        }
    }

}

- (void)setCurrentPage:(NSInteger)currentPage
{
    [super setCurrentPage:currentPage];
    if ([[[UIDevice currentDevice]systemVersion]floatValue] 
        [self updateDots];
    }
//    [self updateDots];
    [self setNeedsDisplay];
}
- (void)setNumberOfPages:(NSInteger)numberOfPages
{
    [super setNumberOfPages:numberOfPages];
    if ([[[UIDevice currentDevice]systemVersion]floatValue] 
        [self updateDots];
    }
//    [self updateDots];
    [self setNeedsDisplay];

}
-(void)drawRect:(CGRect)iRect
{
    int i;
    CGRect rect;

    UIImage *image;
    iRect = self.bounds;

    if ( self.opaque ) {
        [self.backgroundColor set];
        UIRectFill( iRect );
    }

    if ( self.hidesForSinglePage &amp;&amp; self.numberOfPages == 1 ) return;

    rect.size.height = _activeImage.size.height;
    rect.size.width = self.numberOfPages * _activeImage.size.width + ( self.numberOfPages - 1 ) * _kSpacing;
    rect.origin.x = floorf( ( iRect.size.width - rect.size.width ) / 2.0 );
    rect.origin.y = floorf( ( iRect.size.height - rect.size.height ) / 2.0 );
    rect.size.width = _activeImage.size.width;

    for ( i = 0; i 
        image = i == self.currentPage ? _activeImage : _inactiveImage;

        [image drawInRect: rect];

        rect.origin.x += _activeImage.size.width + _kSpacing;
    }
}
@end


&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2013/05/08/%E6%9C%80%E5%A4%A7%E5%85%AC%E5%85%B1%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97lcs-python%E5%AE%9E%E7%8E%B0">最大公共上升子序列(lcs) python实现 </a></h3>
  <div class="date">
    <span>08 May 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>mit 算法导论公开课 15集<br />
http://v.163.com/movie/2010/12/L/4/M6UTT5U0I_M6V2U1HL4.html</p>

<p>实现了求出所有的lcs</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">import copy
import sys
#stringa=&quot;abcbdab&quot;
#stringb=&quot;bdcaba&quot;

stringa=sys.argv[1]
stringb=sys.argv[2]
lena=len(stringa)
lenb=len(stringb)

mapl=[[0 for _ in xrange(lena+1)] for _ in xrange(lenb+1)]
path=[]
for i in xrange(1,lenb+1):
    for j in xrange(1,lena+1):
        if stringa[j-1]==stringb[i-1]:
            mapl[i][j]=mapl[i-1][j-1]+1
            path.append((i,j))
        else:
            mapl[i][j]=max(mapl[i-1][j],mapl[i][j-1])
#for i in mapl:
#   print i
#print path
if len(path)==0:
    print &quot;no lcs&quot;
else:
    backdatestack=[[(lenb,lena),[]]]
    while len(backdatestack)!=0:
        top=backdatestack.pop()
        ansstack=top[1]
        lcs=mapl[top[0][0]][top[0][1]]
        i=top[0][0]
        j=top[0][1]
        while lcs!=0:
            try:
                ind=path.index((i,j))
                ansstack.append(stringb[i-1])
                i-=1
                j-=1
                lcs-=1
            except ValueError:
                if mapl[i-1][j]&gt;&gt;mapl[i][j-1]:&lt;br /&gt;
                    i-=1&lt;br /&gt;
                elif mapl[i-1][j]&lt;mapl[i][j-1]:&lt;br /&gt;
                    j-=1&lt;br /&gt;
                else:&lt;br /&gt;
                    backdatestack.append([(i-1,j),copy.copy(ansstack)])&lt;br /&gt;
                    j-=1&lt;br /&gt;
        while len(ansstack)!=0:&lt;br /&gt;
            print ansstack.pop(),&lt;br /&gt;
        print &lt;/p&gt;

&lt;p&gt;&lt;/p&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2013/05/06/boyer-moore%E7%AE%97%E6%B3%95-python%E5%AE%9E%E7%8E%B0">Boyer-Moore算法 python实现 </a></h3>
  <div class="date">
    <span>06 May 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>看了<a href="http://www.ruanyifeng.com/blog/2013/05/boyer-moore_string_search_algorithm.html?utm_source=feedly">字符串匹配的Boyer-Moore算法</a>后觉得很有用就写一个实现了一下</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">def badcharrule(ori,sear):
    if len(ori)!=len(sear):
        print &quot;error&quot;
    else:
        le=len(ori)
        badindex=-1
        lastindex=-1
        for i in xrange(le-1,0,-1):
            if ori[i]==sear[i]:
                pass
            else:
                badindex=i
                break
        if badindex==-1:
            pass
        else:
            for i in xrange(0,le):
                if sear[i]==ori[badindex]:
                    lastindex=i
                    break
                else:
                    pass
        return badindex-lastindex
def goodpostfixrule(ori,sear):
    if len(ori)!=len(sear):
        print &quot;error&quot;
    else:
        le=len(ori)
        postfix=0
        for i in xrange(le-1,0,-1):
            if ori[i]==sear[i]:
                postfix+=1
            else:
                break
        if postfix==0:
            return -1
        else:
            postfixstring=sear[-postfix:]
            restori=sear[:-postfix]
            if restori.find(postfixstring)==-1:
                restori=postfixstring[:-1]+restori
                if restori.find(postfixstring)==-1:
                    return -1
                else:
                    return len(sear)-restori.find(postfixstring)-1
            else:
                return len(sear)-restori.find(postfixstring)-len(postfixstring)

def movestep(ori,sear):
    gu=badcharrule(ori,sear)
    if gu==0:
        return 0
    else:
        return max(gu,goodpostfixrule(ori,sear))

oristring=&quot;here is a simple example&quot;
searchstring=&quot;example&quot;

index=0
while index+len(searchstring)
    move=movestep(oristring[index:index+len(searchstring)],searchstring)
    if move==0:
        print &quot;find it index=%s&quot; %index
        index+=len(searchstring)
    else:
        index+=move
print &quot;search over&quot;

&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>39</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<!-- </ul> -->

<div id="post-pagination" class="paginator">

  
    <span class="previous disabled">前页</span>
  

      
      <span class="current-page">1</span>
      

    
      
      <a href="/page2">2</a>
      
    
      
      <a href="/page3">3</a>
      
    
      
      <a href="/page4">4</a>
      
    
      
      <a href="/page5">5</a>
      
    
      
      <a href="/page6">6</a>
      
    

  
    <a class="next" href="/page2">后页</a>
  
  (共53篇)
</div>

        </div>
        <hr>
        <footer>
          <p>&copy; 2014 Xinzheng ZhangPowered by Jekyll @ GitHub
          </p>
        </footer>

      </div>
    </div>
    
  </body>
</html>

