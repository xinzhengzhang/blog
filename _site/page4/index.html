
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>snorlax's Homepage</title>
    
    <meta name="author" content="Xinzheng Zhang">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments.css?body=1" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Snorlax's blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archives</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




          </ul>
        </div>
      </div>
    </div>
    <div class="container_wrapper">
      <div class="container-narrow">
        <div class="content">
          <!-- <ul class="listing"> -->

<div class="page-header">
  <h3><a href="/gossip/2013/01/01/rc4-python%E5%AE%9E%E7%8E%B0">rc4 python实现 </a></h3>
  <div class="date">
    <span>01 January 2013</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>复习密码无事写了个rc4、早上随便说点新年愿望其实也有个就写里面了……</p>

<p>闲得蛋疼得就解了吧（不过tm简单过份了吧喂！</p>

<p><a href="http://snorlax-wordpress.stor.sinaapp.com/uploads/2013/01/734420E9-D793-4822-9B07-01A783B74818.jpg"><img class="alignnone size-full wp-image-174" title="734420E9-D793-4822-9B07-01A783B74818" src="http://snorlax-wordpress.stor.sinaapp.com/uploads/2013/01/734420E9-D793-4822-9B07-01A783B74818.jpg" alt="" width="523" height="551" /></a></p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#gossip-ref">
    		gossip <span>5</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/12/23/os-x-%E7%9A%84%E5%90%AF%E5%8A%A8%E9%A1%B9">os x 的启动项 </a></h3>
  <div class="date">
    <span>23 December 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>每次开机总要开几个脚本开烦了、然后研究了下自己机器的几个开机自启的程序的写法总结了下</p>

<p>首先是这个目录 然后我分别展开了/Library/StartupItems 以及集中的mysql可以看到里面就是主要一个是StartupParameters.plist 以及一个sh</p>

<p><a href="http://snorlax-wordpress.stor.sinaapp.com/uploads/2012/12/8460C8BA-D46E-4C02-B3B6-01AF84D6F28E.jpg"><img class="alignnone size-full wp-image-167" title="8460C8BA-D46E-4C02-B3B6-01AF84D6F28E" src="http://snorlax-wordpress.stor.sinaapp.com/uploads/2012/12/8460C8BA-D46E-4C02-B3B6-01AF84D6F28E.jpg" alt="" width="501" height="69" /></a></p>

<p>然后解释下里面分别怎么写</p>

<p><p>首先是 StartupParameters.plist这个xml里面的内容大致是</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&amp;gt;
&amp;lt;plist version=&quot;1.0&quot;&amp;gt;
&amp;lt;dict&amp;gt;
    &amp;lt;key&amp;gt;Description&amp;lt;/key&amp;gt;
    &amp;lt;string&amp;gt;MySQL 5.5.20-community&amp;lt;/string&amp;gt;
    &amp;lt;key&amp;gt;OrderPreference&amp;lt;/key&amp;gt;
    &amp;lt;string&amp;gt;None&amp;lt;/string&amp;gt;
    &amp;lt;key&amp;gt;Provides&amp;lt;/key&amp;gt;
    &amp;lt;array&amp;gt;
        &amp;lt;string&amp;gt;MySQL&amp;lt;/string&amp;gt;
    &amp;lt;/array&amp;gt;
    &amp;lt;key&amp;gt;Uses&amp;lt;/key&amp;gt;
    &amp;lt;array&amp;gt;
        &amp;lt;string&amp;gt;Network&amp;lt;/string&amp;gt;
        &amp;lt;string&amp;gt;Resolver&amp;lt;/string&amp;gt;
    &amp;lt;/array&amp;gt;
    &amp;lt;/dict&amp;gt;
&amp;lt;/plist&amp;gt;
主要有几个key description OrderPreference Provides Uses
具体是什么如下
&quot;Description&quot; is a simple description of the service, which is only used to describe the file and not during the startup process.

&quot;Provides&quot; specifies the services that this StartupItems provides. Provides can contain multiple services, but it is not recommended. Here Apache provides a &quot;Web Server&quot; service.

&quot;Requires&quot; specifies the services that have to be started before this StartupItem is loaded. The values in this field are those of other StartupItems&#39; &quot;Provides&quot; fields. Apache requires &quot;DirectoryServices&quot; to be loaded before it can be run; if DirectoryServices are not specified to run or fail to run properly Apache won&#39;t run.

&quot;Uses&quot; specifics the services that should be started before this StartupItem is loaded. This is similar to the &quot;Requires&quot; attribute except this service will always be loaded, but only after it has tried to execute all the services in &quot;Uses&quot;. Apache uses the &quot;Disks&quot;, &quot;NFS&quot;, and &quot;Network Time&quot; services. OS X will try to load these services, if it can&#39;t it will still load Apache, but only after trying these services first.

&quot;OrderPreference&quot; specifies the general time period in which a StartupItem will be executed. This order is less significant than both &quot;Requires&quot; and &quot;Uses&quot; but is used to determine order after evaluating those attributes. The possible values for this attribute are: First, Early, None (default), Late, Last. Apache specifies no OrderPreference as to when it should be loaded.

然后就是写的脚本了

简单点的写法就这样
#!/bin/sh
. /etc/rc.common

StartService ()
{
    ConsoleMessage &quot;Running script.&quot;
    python /Users/zxz/work/xxxx.py
}

StopService ()
{
    return 0
}

RestartService ()
{
    return 0
}

RunService &quot;$1&quot;
里面的shell就随意怎么写了

然后正常的 start stop restart也都可以正常用了

ps.最后记得注意要修改脚本的权限……chown root:wheel chmod 755
&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/12/07/%E7%9B%B8%E4%BC%BC%E5%9B%BE%E7%89%87%E6%90%9C%E7%B4%A2python%E5%AE%9E%E7%8E%B0">相似图片搜索python实现 </a></h3>
  <div class="date">
    <span>07 December 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>先贴原文<a href="http://blog.csdn.net/luohong722/article/details/7100058">http://blog.csdn.net/luohong722/article/details/7100058</a><br />
其实这篇文章已经写的非常详细了、不过也作为巩固自己再梳理一遍<br />
首先这个算法的流程简直简单的令人发指、导致我做的时候完全不觉得这真的可能搜索出什么东西来……<br />
几步流程分别如下<br />
1.压缩成8*8的小图<br />
2.灰化<br />
3.算均值二值化<br />
4.生成64位标示码<br />
5.比较标示码 越接近越相似<br />
貌似好像应该是sift算法的简便吧（也不能简便成这样啊……<br />
---------------------------下面是程序主要逻辑一共就十几行--------------------------<br />
主要用到了python的PIL库</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">from PIL import Image
def picHash(im):
    if not isinstance(im, Image.Image):
        im = Image.open(im)
    #平滑的压成8*8 并灰化
    im = im.resize((8, 8), Image.ANTIALIAS).convert(&#39;L&#39;)
    avg = reduce(lambda x, y: x + y, im.getdata()) / 64.0
    return map(lambda i: 0 if i &amp;lt; avg else 1, im.getdata())

def diffCount(h1,h2):
    h=0
    for i in range(64):
       if h1[i]!=h2[i]:
           h+=1
    return h
然后呢……然后没了……就是那么简单……最后发一下效果图
图片样本20张
最后搜出的近似度前5的左上为搜索原图

效果还是非常不错的、样本里只有一张未被选出
&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/12/07/%E5%85%B3%E4%BA%8Epython%E5%9B%BE%E5%BD%A2%E5%BA%93pil%E5%9C%A8mac-os%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85">关于python图形库pil在mac os下的安装 </a></h3>
  <div class="date">
    <span>07 December 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>首先在mac os的环境下根据官方给出的release版本
<a href="http://effbot.org/downloads/Imaging-1.1.7.tar.gz" title="Python Imaging Library 1.1.7 Source Kit ">Python Imaging Library 1.1.7 Source Kit</a> <br />
如果在debian下可以非常简便的就<br />
sudo apt-get install libjpeg62-dev<br />
sudo apt-get install zlib1g-dev<br />
sudo apt-get install libfreetype6-dev<br />
sudo apt-get install liblcms1-dev<br />
然后就 python setup.py install 轻松又愉快<br />
可是mac的说明我有点蒙</p>

<p>--------------------------------------------------------------------<br />
Additional notes for Mac OS X<br />
--------------------------------------------------------------------</p>

<p>On Mac OS X you will usually install additional software such as<br />
libjpeg or freetype with the "fink" tool, and then it ends up in<br />
"/sw".  If you have installed the libraries elsewhere, you may have<br />
to tweak the "setup.py" file before building.</p>

<p>反正我一开始也就理所当然的当成usually install additional software的一份子了、当然结果肯定是残忍的<br />
pil是可以用但是任何的解析基本都会报类似<br />
raise IOError decoder s not available decoder_name IOError decoder jpeg not available的错</p>

<p>google了无数各种做ln连来连去的……<br />
注意一点就是 3一下的版本都在 /System/Library/Frameworks/Python.framework/Versions/下<br />
3以上的版本都在 /Library/Frameworks/Python.framework/Versions<br />
然后site-package<br />
分别在<br />
/Library/Python/2.7/site-packages<br />
/Library/Python/2.3/site-packages<br />
/usr/local/git/lib/python2.7/site-packages<br />
/Library/Python/2.5/site-packages<br />
/Library/Python/2.6/site-packages<br />
/Library/Frameworks/Python.framework/Versions/3.2/lib/python3.2/site-packages<br />
/usr/local/lib/python3.2/site-packages<br />
混乱了吧……记得你装的是哪儿个版本、然后在configure之前要都设置对路径……私认为这绝对是太残忍了……<br />
-----------------------------------分割线--------------------------------------<br />
下面是经过实践出的最简单的方法、就用python自带的easy_install里的pip这样默认都帮你configure完了也不用你纠结了<br />
就这么几句就搞定了<br />
sudo easy_install pip<br />
sudo brew install jpeg<br />
sudo brew install libjpeg<br />
sudo pip uninstall pil<br />
sudo pip install pil</p>

<p>搞定记得顺序、先要装依赖</p>

<p>附上PIL的文档:<br />
http://www.pythonware.com/library/pil/handbook/index.htm</p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/12/04/ios-safari5-webview%E5%AF%B9-contenteditable-%E7%9A%84%E4%BF%AE%E6%AD%A3">ios safari5 webview对 contenteditable 的修正 </a></h3>
  <div class="date">
    <span>04 December 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>自从上次发现了html5的神器标签contenteditable后一直忽视了一个问题、因为一直跑的机器都是ios6（六毫无问题）、当放到5时出一个很大的问题、每次进入编辑时焦点会被放到整个body的最上面、毫无疑问这个糟糕的体验是不可能让用户自己去解决的所以需要解决。</p>

<p>首先先是native和js交互的问题、也许js太过庞大、webview完全没有做任何关于js callback的api、唯一只有一个<br />
- (NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script;<br />
只能往里插js却获不得回调、这样没人性的行为绝对是无法容忍的、竟然phonegap什么的可以就一定有解决途径。<br />
既然js无法获得回调、就从webview的回调入手、查了他的三个delegate后办法有了、就是更改document.location加一个?xx=xx相当于一个get请求、然后通过回调去拿到xx然后做native<br />
可是这样我马上就发现了不适宜contenteditable的一个问题、就是一个点击事件同时触发了编辑以及跳转事件后、后者覆盖了前者、网上主流说的也是这个方法、找了半天终于找到了替代法<a href="http://blog.devtang.com/blog/2012/03/24/talk-about-uiwebview-and-phonegap/"></a>详见最后的这段js代码、最后需要做的就是给需要编辑的标签绑定上事件 通过鼠标的点击拿到pageY的偏移量 通过uiwebview.uiscrollview setContentOffset来调整偏移量即可修复safari5对contenteditable这极不友好的支持、代码如下</p>

<p>
```

var edit = document.getElementById(\"editable\");edit.addEventListener(\"click\",function(e){var iFrame;iFrame = document.createElement(\"iframe\");iFrame.setAttribute(\"src\", \"noteOffset:\"+e.pageY);iFrame.setAttribute(\"style\", \"display:none;\");iFrame.setAttribute(\"height\", \"0px\");iFrame.setAttribute(\"width\", \"0px\");iFrame.setAttribute(\"frameborder\", \"0\");document.body.appendChild(iFrame);iFrame.parentNode.removeChild(iFrame);iFrame = null;}, false);

然后在回调中写

#pragma UIWebViewDelegate
-(BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType
{
    NSLog(@"------");
    NSLog(@"%@",[[request URL]absoluteString]);
    if ([[[request URL]absoluteString]judgeNoteBodyEditMode] && [[request URL]absoluteString].length>>3) {
        
        NSLog(@"%d",[[[[request URL]absoluteString]substringFromIndex:[[request URL]absoluteString].length-3]integerValue]);
        [showRichText.scrollView setContentOffset:CGPointMake(showRichText.scrollView.contentOffset.x,[[[[request URL]absoluteString]substringFromIndex:[[request URL]absoluteString].length-3]integerValue])];
    }
    return YES;
}
</pre></p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/12/03/ios%E5%87%A0%E7%A7%8D%E5%9F%BA%E6%9C%AC%E8%A7%86%E5%9B%BE%E5%88%87%E6%8D%A2%E5%8A%A8%E7%94%BB%E5%B0%8F%E7%BB%93">ios几种基本视图切换动画小结 </a></h3>
  <div class="date">
    <span>03 December 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>搞清楚试图首先先要搞清UIWindows UIView CALayer 这几者的关系<br />
推荐两篇文章
<a href="http://blog.csdn.net/holydancer/article/details/7422365">http://blog.csdn.net/holydancer/article/details/7422365</a>
<a href="http://www.cnblogs.com/lovecode/articles/2249548.html">http://www.cnblogs.com/lovecode/articles/2249548.html</a>
在理解的基础上上就是几个常用的切换了<br />
首先如果整体用的是navigationcontroller 的话常用的就是这三组方法

```

- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated; // Uses a horizontal slide transition. Has no effect if the view controller is already in the stack.

- (UIViewController *)popViewControllerAnimated:(BOOL)animated; // Returns the popped controller.
- (NSArray *)popToViewController:(UIViewController *)viewController animated:(BOOL)animated; // Pops view controllers until the one specified is on top. Returns the popped controllers.
- (NSArray *)popToRootViewControllerAnimated:(BOOL)animated; // Pops until there's only a single view controller left on the stack. Returns the popped controllers.


这三种的切换效果基本都是左右推送那种感觉

再然后是用这两组切换

- (void)presentViewController:(UIViewController *)viewControllerToPresent animated: (BOOL)flag completion:(void (^)(void))completion NS_AVAILABLE_IOS(5_0);
// The completion handler, if provided, will be invoked after the dismissed controller's viewDidDisappear: callback is invoked.
- (void)dismissViewControllerAnimated: (BOOL)flag completion: (void (^)(void))completion NS_AVAILABLE_IOS(5_0);

// Display another view controller as a modal child. Uses a vertical sheet transition if animated.This method has been replaced by presentViewController:animated:completion:
- (void)presentModalViewController:(UIViewController *)modalViewController animated:(BOOL)animated NS_DEPRECATED_IOS(2_0, 6_0);

// Dismiss the current modal child. Uses a vertical sheet transition if animated. This method has been replaced by dismissViewControllerAnimated:completion:
- (void)dismissModalViewControllerAnimated:(BOOL)animated NS_DEPRECATED_IOS(2_0, 6_0);


这几种的默认的动画是上下卷（翻？）
最简单的更改动画方式就是在下一层需要切换的试图上使用 setModalTransitionStyle 方法可以设置为以下几种效果

UIModalTransitionStyleCoverVertical = 0,//垂直上下（默认那种）    UIModalTransitionStyleFlipHorizontal, //翻页

    UIModalTransitionStyleCrossDissolve, //淡出

#if __IPHONE_OS_VERSION_MAX_ALLOWED >>= __IPHONE_3_2</p>

<p>    UIModalTransitionStylePartialCurl, //立体</p>

<p></p>

<p><p>再然后如果需要更加精细的定制动画那么就要动用上#import <QuartzCore/QuartzCore.h>了在framework中加入QuartzCore然后使用CATransition对layer进行设置、这段代码一半可以加在viewWillAppear viewWillDisapper这两个地方中使用、大致的用法如下</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">        CATransition *animation=[CATransition animation];
        animation.delegate = self;
        animation.duration = 0.1f;//动画运行时间
        animation.timingFunction = UIViewAnimationCurveEaseInOut;//动画的时间分布（平均、两头快、快到慢等）
        animation.fillMode =  kCAFillModeForwards;//(填充的方式)
        animation.type = kCATransitionPush;//(动画覆盖过去的样子比如push movein等)
        animation.subtype = kCATransitionFromLeft;//(动画的方向)
        [self.view.layer addAnimation:animation forKey:@&quot;animation&quot;];//给这张view的layer层添加这个动画并给个key一会用来删除
        [self.view.layer removeAnimationForKey:@&quot;animation&quot;];//用来删



基本几种方法就是这样然后有一点小技巧
在正常的addsubView等方法使用动画CATransition的动画是安全没有问题的、可是如果你使用presentModalViewController等类似的会把之前的清掉的方法时就会出现一个问题、因为前面清掉了所以背景是黑色的、整个动画是做在黑色背景上的非常难看。在不破坏自己原来代码架构的情况下我就想到了一个方法在presentmodalviewController里的animated的参数置为YES然后设置为淡出效果、然后再继续用CATransition、这样相当于同时做两个动画但是那个淡出效果很淡看得很舒服完全是不会影响本来写得动画效果的
</code></pre></div>
<blockquote>
</blockquote>
<div class="highlight"><pre><code class="text language-text" data-lang="text">
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/11/28/bmp%E3%80%81png%E5%88%9D%E7%90%86%E8%A7%A3">bmp、png初理解 </a></h3>
  <div class="date">
    <span>28 November 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>主要还是写下bmp图的操作(另外两个看的实在头大<br />
首先bmp的头是由三部分组成的、分别是位图头、位图信息、调色板<br />
下面就是位图数据了<br />
详见<a href="http://zh.wikipedia.org/zh/BMP#.E8.B0.83.E8.89.B2.E6.9D.BF"><a href="http://zh.wikipedia.org/zh/BMP#.E8.B0.83.E8.89.B2.E6.9D.BF">http://zh.wikipedia.org/zh/BMP#.E8.B0.83.E8.89.B2.E6.9D.BF</a></a>
我用了以下的三个结构体用来接bmp头 然后再一个来接像素数据</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">//
//  BmpLab.h
//  labfor12c
//
//  Created by zxz on 12-11-28.
//  Copyright (c) 2012年 zxz. All rights reserved.
//

#ifndef labfor12c___BmpLab_h
#define labfor12c___BmpLab_h

typedef struct __BitMapHead{
//    __uint16_t fileType;  //default BM
    __uint32_t fileSize;
    __uint32_t unDefined; //undefined
    __uint32_t fileOffset;
}BitMapHead;

typedef struct __BitMapInfo{
    __uint32_t infoHeadSize; //40
    __uint32_t bitMapWidth;
    __uint32_t bitMapHeight;
    __uint16_t bitMapColorPlanes; //彩色位面的个数（不懂
    __uint16_t bitMapPixelBit; //1 4 8 灰阶 24彩
    __uint32_t bitMapCompression; //0 - 没有压缩（也用BI_RGB表示）    1 - 行程长度编码 8位/像素（也用BI_RLE8表示）    2 - 行程长度编码4位/像素（也用BI_RLE4表示）    3 - Bit field（也用BI_BITFIELDS表示）    4 - JPEG图像（也用BI_JPEG表示）    5 - PNG图像（也用BI_PNG表示）
    __uint32_t bitMapBodySize;
    __uint32_t bitMapXPixel;  //水平分辨率
    __uint32_t bitMapYPixel;  //垂直分辨率
    __uint32_t bitMapColorUsed;
    __uint32_t bitMapImportantColorUsed;

}BitMapInfo;

typedef struct __RGBQUARD{
    __uint8_t rgbRed;
    __uint8_t rgbGreen;
    __uint8_t rgbBlue;
    __uint8_t rgbReserved;
}RGBQUARD;

typedef struct __pixelData
{
    __uint8_t blue;
    __uint8_t green;
    __uint8_t red;
}pixelData;
#endif

再然后就是把文件rb打开分别用上面的结构体接就可以了
其中要注意的下因为type是2个字节的、结构体是会补齐的也就是如果直接一起读进去后面都会乱的
所以我把type从结构体里注释了、选择先读进2个字节、然后再一并读进去

//
//  main.c
//  labfor12c
//
//  Created by zxz on 12-11-26.
//  Copyright (c) 2012年 zxz. All rights reserved.
//

#include 
#include 
#include &quot;BmpLab.h&quot;

BitMapHead head;
BitMapInfo info;
RGBQUARD color[256];
int main(int argc, const char * argv[])
{

    FILE *fpr,*fpw;
    fpr=fopen(&quot;test_binaryImg.bmp&quot;, &quot;rb&quot;);
    if (!fpr) {
        printf(&quot;open fail&quot;);
    }
    else
    {
        __uint16_t type;
        fread(&amp;type, 1, sizeof(__uint16_t), fpr);
        if (type!=0x4d42) {
            printf(&quot;not a bmp file&quot;);
            return 1;
        }
        fread(&amp;head, 1, sizeof(BitMapHead), fpr);
        fread(&amp;info, 1, sizeof(BitMapInfo), fpr);
        unsigned int nCounti=0;
        for(nCounti=0;nCounti
        {
            fread((char *)&amp;(color[nCounti].rgbBlue),1,sizeof(__uint8_t),fpr);
            fread((char *)&amp;(color[nCounti].rgbGreen),1,sizeof(__uint8_t),fpr);
            fread((char *)&amp;(color[nCounti].rgbRed),1,sizeof(__uint8_t),fpr);
            fread((char *)&amp;(color[nCounti].rgbReserved),1,sizeof(__uint8_t),fpr);
        }
    }
    __uint8_t *imgdata=(__uint8_t*)malloc(info.bitMapWidth*((sizeof(pixelData)+3)&amp;~4)*info.bitMapHeight); //向4取整（早上学完装逼的方法马上来用……
    fread(imgdata, sizeof(pixelData)*info.bitMapWidth, info.bitMapHeight, fpr);
    //deal with the preix
    return 0;
}


往回保存的时候修改下头里面的数据然后往回写即可

接着是png和jpeg、开始我 以为的是他们和位图一样简单呢……我还是太年轻了……
还是先看下png的头吧
png的头首先是一个8个字节的标示
89 50 4E 47 0D 0A 1A 0A
接下去是4个标准数据块
分别是文件头数据块IHDR(header chunk)：包含有图像基本信息，作为第一个数据块出现并只出现一次。
调色板数据块PLTE(palette chunk)：必须放在图像数据块之前。
图像数据块IDAT(image data chunk)：存储实际图像数据。PNG数据允许包含多个连续的图像数据块。
图像结束数据IEND(image trailer chunk)：放在文件尾部，表示PNG数据流结束。

其中的每个数据块的结构是
Length(长度)  4字节  指定数据块中数据域的长度，其长度不超过(231－1)字节
Chunk Type Code(数据块类型码) 4字节  数据块类型码由ASCII字母(A-Z和a-z)组成
Chunk Data(数据块数据) 可变长度     存储按照Chunk Type Code指定的数据
CRC(循环冗余检测) 4字节  存储用来检测是否有错误的循环冗余码

每块数据块的具体详见http://dev.gameres.com/Program/Visual/Other/PNGFormat.htm
又是CRC什么的一搞就没兴趣去写代码解析了……
原来png jpeg这种头格式上半毛钱都关系不上啊……

&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/program/2012/11/24/regexkit%E7%AC%94%E8%AE%B0">RegexKit笔记 </a></h3>
  <div class="date">
    <span>24 November 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>由于ios 的sdk并不原生支持正则、所有用到了第三方库、对比了下文档等、我最终决定使用regexKit</p>

<p>文档 http://regexkit.sourceforge.net/RegexKitLite/</p>

<p>使用简单说明</p>

<p>这个库的基础是在 ICU(INTERNATIONAL COMPONENTS FOR UNICODE)之上的、在使用过程中需要将 RegexKitLite.h /RegexKitLite.m 导入工程之外还需要动态链接库 libicucore.dylib 然后在需要编译的文件上加上 -licucore 即可</p>

<p>1. 寻找匹配的范围</p>

<p>匹配范围的有多个函数举个最长的做例子</p>

<p><p>&nbsp;</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">- (NSRange)RKL_METHOD_PREPEND(rangeOfRegex):(NSString *)regex options:(RKLRegexOptions)options inRange:(NSRange)range capture:(NSInteger)capture error:(NSError **)error;
&amp;nbsp;

别的根据名字也都可判断了、其中要注意点的就是 capture 这个参数是返回的匹配成功的第几个、他的匹配的模式是贪心的模式

与之类似的判断匹配的返回的是匹配出的串
- (NSString *)RKL_METHOD_PREPEND(stringByMatching):(NSString *)regex capture:(NSInteger)capture

- (NSString *)RKL_METHOD_PREPEND(stringByMatching):(NSString *)regex options:(RKLRegexOptions)options inRange:(NSRange)
2.寻找和替换
NSString *searchString = @&quot;This is neat.&quot;;

NSString *regexString = @&quot;\\b(\\w+)\\b&quot;;

NSString *replaceWithString = @&quot;{$1}&quot;;

NSString *replacedString = NULL;

replacedString = [searchString stringByReplacingOccurrencesOfRegex:regexString withString:replaceWithString];
注意这里的替换的replaceWithString如果有$符、他会理解成对之前匹配出的串的附加如以上例子匹配完之后就是 {This} {is} {neat}.

如果需要更复杂的运算可以使用block
replacedString =[searchString stringByReplacingOccurrencesOfRegex:regexString usingBlock:^NSString *(NSInteger captureCount, NSString * const capturedStrings[captureCount], const NSRange capturedRanges[captureCount], volatile BOOL * const stop){return ([NSString stringWithFormat:@&quot;%@&quot;,[capturedStrings[1] capitalizedString]]);}];
3.对每个匹配模式的形成array、切割成array
- (NSArray *)RKL_METHOD_PREPEND(componentsMatchedByRegex):(NSString *)regex options:(RKLRegexOptions)options range:(NSRange)range capture:(NSInteger)capture error:(NSError **)error

- (NSArray *)RKL_METHOD_PREPEND(componentsSeparatedByRegex):(NSString *)regex options:(RKLRegexOptions)options range:(NSRange)range error:(NSError **)error
基本的操作就如上、每块分别还有不同的接口、基本命名规范都大同小异、复杂的就使用block

其中的 RKLRegexIptions 是一个如下的结构
enum {

RKLNoOptions             = 0,   //无特殊意义

RKLCaseless              = 2,    //不敏感大小写模式

RKLComments              = 4,//允许在模式中使用空格

RKLDotAll                = 32, //使用行读取模式

RKLMultiline             = 8, //^和$也会匹配每行

RKLUnicodeWordBoundaries = 256 //Controls the behavior of \b in a pattern. If set, word boundaries are found according to the definitions of word found in Unicode UAX 29 - Text Boundaries. By default, word boundaries are identified by means of a simple classification of characters as either word or non-word, which approximates traditional regular expression behavior. The results obtained with the two options can be quite different in runs of spacesand other non-word characters.

};
然后附上ICU的正则标准



Metacharacters


Character
Description


\a
Match a BELL, \u0007


\A
Match at the beginning of the input. Differs from ^ in that \A will not match after a new-line within the input.


\b, outside of a [Set]
Match if the current position is a word boundary. Boundaries occur at the transitions between word \w and non-word \W characters, with combining marks ignored.
See also: RKLUnicodeWordBoundaries


\b, within a [Set]
Match a BACKSPACE, \u0008.


\B
Match if the current position is not a word boundary.


\cx
Match a Control-x character.


\d
Match any character with the Unicode General Category of Nd(Number, Decimal Digit).


\D
Match any character that is not a decimal digit.


\e
Match an ESCAPE, \u001B.


\E
Terminates a \Q…\E quoted sequence.


\f
Match a FORM FEED, \u000C.


\G
Match if the current position is at the end of the previous match.


\n
Match a LINE FEED, \u000A.


\N{Unicode Character Name}
Match the named Unicode Character.


\p{Unicode Property Name}
Match any character with the specified Unicode Property.


\P{Unicode Property Name}
Match any character not having the specified Unicode Property.


\Q
Quotes all following characters until \E.


\r
Match a CARRIAGE RETURN, \u000D.


\s
Match a white space character. White space is defined as[\t\n\f\r\p{Z}].


\S
Match a non-white space character.


\t
Match a HORIZONTAL TABULATION, \u0009.


\uhhhh
Match the character with the hex value hhhh.


\Uhhhhhhhh
Match the character with the hex value hhhhhhhh. Exactly eight hex digits must be provided, even though the largest Unicode code point is \U0010ffff.


\w
Match a word character. Word characters are[\p{Ll}\p{Lu}\p{Lt}\p{Lo}\p{Nd}].


\W
Match a non-word character.


\x{h…}
Match the character with hex value hhhh. From one to six hex digits may be supplied.


\xhh
Match the character with two digit hex value hh.


\X
Match a Grapheme Cluster.


\Z
Match if the current position is at the end of input, but before the final line terminator, if one exists.


\z
Match if the current position is at the end of input.


\n

Back Reference. Match whatever the nth capturing group matched. nmust be a number ≥ 1 and ≤ total number of capture groups in the pattern.



Note:
Octal escapes, such as \012, are not supported.





[pattern]
Match any one character from the set. See ICU Regular Expression Character Classes for a full description of what may appear in the pattern.


.
Match any character.


^
Match at the beginning of a line.


$
Match at the end of a line.


\
Quotes the following character. Characters that must be quoted to be treated as literals are * ? + [ ( ) { } ^ $ | \ . /





Operators


Operator
Description


|
Alternation. A|B matches either A or B.


*
Match zero or more times. Match as many times as possible.


+
Match one or more times. Match as many times as possible.


?
Match zero or one times. Prefer one.


{n}
Match exactly n times.


{n,}
Match at least n times. Match as many times as possible.


{n,m}
Match between n and m times. Match as many times as possible, but not more than m.


*?
Match zero or more times. Match as few times as possible.


+?
Match one or more times. Match as few times as possible.


??
Match zero or one times. Prefer zero.


{n}?
Match exactly n times.


{n,}?
Match at least n times, but no more than required for an overall pattern match.


{n,m}?
Match between n and m times. Match as few times as possible, but not less than n.


*+
Match zero or more times. Match as many times as possible when first encountered, do not retry with fewer even if overall match fails. Possessive match.


++
Match one or more times. Possessive match.


?+
Match zero or one times. Possessive match.


{n}+
Match exactly n times. Possessive match.


{n,}+
Match at least n times. Possessive match.


{n,m}+
Match between n and m times. Possessive match.


(…)
Capturing parentheses. Range of input that matched the parenthesized subexpression is available after the match.


(?:…)
Non-capturing parentheses. Groups the included pattern, but does not provide capturing of matching text. Somewhat more efficient than capturing parentheses.


(?&amp;gt;…)
Atomic-match parentheses. First match of the parenthesized subexpression is the only one tried; if it does not lead to an overall pattern match, back up the search for a match to a position before the (?&amp;gt; .


(?#…)
Free-format comment (?#comment).


(?=…)
Look-ahead assertion. True if the parenthesized pattern matches at the current input position, but does not advance the input position.


(?!…)
Negative look-ahead assertion. True if the parenthesized pattern does not match at the current input position. Does not advance the input position.


(?&amp;lt;=…)
Look-behind assertion. True if the parenthesized pattern matches text preceding the current input position, with the last character of the match being the input character just before the current position. Does not alter the input position. The length of possible strings matched by the look-behind pattern must not be unbounded (no * or + operators).


(?&amp;lt;!…)
Negative Look-behind assertion. True if the parenthesized pattern does not match text preceding the current input position, with the last character of the match being the input character just before the current position. Does not alter the input position. The length of possible strings matched by the look-behind pattern must not be unbounded (no * or + operators).


(?ismwx-ismwx:…)
Flag settings. Evaluate the parenthesized expression with the specified flagsenabled or -disabled.


(?ismwx-ismwx)
Flag settings. Change the flag settings. Changes apply to the portion of the pattern following the setting. For example, (?i) changes to a case insensitive match.
See also: Regular Expression Options






&gt;
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>47</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/gossip/2012/11/16/%E8%A2%ABwindows%E8%89%B9%E4%BA%86%E4%B8%80%E5%A4%A9%E7%9A%84%E5%B0%8F%E6%84%9F">被windows艹了一天的小感 </a></h3>
  <div class="date">
    <span>16 November 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p>作为一个ms黑、都三年了也没正经的写过一点windows、今天算是头天吧……然后就被打击透顶了</p>

<p>需求就是让台电脑崩了、这么个需求我就出了2个方案、</p>

<p>1.想办法拿到个内核态的指针然后喀了然后蓝掉</p>

<p>2.蔽了键盘和鼠标也同样效果实现了</p>

<p>反正就是这两条路子坑了我走了一天……</p>

<p>先是一、想尽办法奈何不了大windows封装的太深、册那每个函数那么多参数看来不是没道理的、怪不得野指针那么容易指死机、想从驱动入手、没办法完全没有驱动编程的基础、没办法第一条路就死了</p>

<p>然后是二、这个还是挺容易下手的、网上也到处都是类似的代码但是我还是失败了……首先我想到的是全局钩子（就是把所有的按键事件捕获住然后直接吃掉</p>

<p>零基础痛苦的开始看api的阶段就不说了……（虽然说搞懂了后还是非常简单的</p>

<p>然后就全局吃掉键盘和鼠标嘛看着很愉快的、然后丢到同学机子上一测、傻逼了、大360直接监测出来了我拿了键鼠去提醒用户了（伪装性差透了、失败</p>

<p>接着无限的搜索我又发现了系统API竟然可以直接蔽掉INPUT、好吧我真的激动了半天、你360总不能杀系统API吧、好了就3行代码……效果实现了、360也没杀出来、又高兴了一阵然后我又发现傻逼了……任务管理器还是能调出来的、而且这个系统API是在当前进程下的、也就是任务管理器一出一杀我就悲剧了……又失败了……失败了怎么就能倒下、我又开始做局部的钩子杀掉ctrl 杀掉alt 都没问题……可是单独的杀是没问题的组合起来又悲剧了……好吧既然杀不掉你的启动方式我就杀你这个服务、又找了在注册表禁了、可是这大概是几年前的文章吧、混蛋还是好好的跑起来……那我再想、直接拿文件流去写你的文件吧、两跟进程跑着看你怎么开、当然愿望肯定是美好的……没权限……崩溃了……然后我又只能放弃二了</p>

<p>然后上面这点试试下来整整一天就没了Orz……</p>

<p>没办法放弃了、看来报着的心态是坏的、也是做不大出来东西的……想去论坛问问都不晓得怎么开口……</p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#gossip-ref">
    		gossip <span>5</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<div class="page-header">
  <h3><a href="/life/2012/11/14/%E4%B8%80%E4%BA%BA%E6%9A%AE%E3%82%89%E3%81%97">一人暮らし </a></h3>
  <div class="date">
    <span>14 November 2012</span>
  </div>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="content">
      <p><p>最近心情很差、很多很多方面</p>

<p>今天也是如此、不知道为什么看到那些在比赛html5的心情很差、主要原因应该就是觉得我也应该是其中一员吧</p>

<p>当然放弃也是我自己当时的抉择、也没有任何人好怪的、当时开始报名的时候我就怀着的心态就非常矛盾、大概也应该是心疼那三百块钱吧……再其实也不是因为那一点报名费、而是就只有我一个人的无助感吧、我总是就这么一个人、一个人……我也觉得我不是冷无缺也不是什么很难相处的人为什么我的朋友很少呢、不管任何方面</p>

<p>有时候就是想这么去找个可以和自己一起去打的人都好难、算了纠结原因也就是我那个奇怪的性格吧、做项目也是如此、当我一个人打的时候我并没有感觉什么、当我有队友时当我们没法合拍时我也不知道怎么办、我也知道他们可以一起帮忙、可是为什么我有这份心却怎么样都合不起来、合不起来合不起来我只能一次次放弃、讽刺的到现在我应该一个像样的东西都没有做出来过吧、我很佩服那个做猛犸browser的孩子、或许他的心态就跟我一样、但是他却可以作出一件件像样的东西、而我这个渣也就这么只会去惆怅下去吧、其实这麻痹就还是归结于一个缩字</p>

<p>其实我真的不想永远一个人从早上挖开眼睛就对着我的电脑老婆、不想永远一个人的走在校园的路上、不想一个人出去看电影、不想一个人出去吃饭、真的不想</p>

<p>想想一个人在学校住了十二年、想想一个人了二十年、想想才有几个交心的朋友、或者这才是我上次哭的原因、或许这才是我的悲哀吧</p>

<p>牢骚发完了、尽快从最近这状态出来吧、傻逼你二十年的人生不是早已经习惯了么？</p>

<p></p></p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#life-ref">
    		life <span>5</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
  



    </ul>
  
  </div>
</div>


<!-- </ul> -->

<div id="post-pagination" class="paginator">

  
    
    <a href="/page3">前页</a>
    
  

      
      <a href="/">1</a>
      

    
      
      <a href="/page2">2</a>
      
    
      
      <a href="/page3">3</a>
      
    
      
      <span class="current-page">4</span>
      
    
      
      <a href="/page5">5</a>
      
    
      
      <a href="/page6">6</a>
      
    

  
    <a class="next" href="/page5">后页</a>
  
  (共59篇)
</div>

        </div>
        <hr>
        <footer>
          <p>&copy; 2014 Xinzheng ZhangPowered by Jekyll @ GitHub
          </p>
        </footer>

      </div>
    </div>
    
  </body>
</html>

