
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>注入qq</title>
    <meta name="description" content="">
    <meta name="author" content="Xinzheng Zhang">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments.css?body=1" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Snorlax's blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About me</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archives</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




          </ul>
        </div>
      </div>
    </div>
    <div class="container_wrapper">
      <div class="container-narrow">
        <div class="content">
          
<div class="page-header">
  <h1>注入qq </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>20 February 2015</span>
    </div>
    <div class="content">
      <h4>背景</h4>

<ul>
<li>像除夕这种好时节……tx什么红包发疯了那么安全性呢= =脑洞一开我就试试我这么个完全没碰过反向的人能玩成什么样子</li>
</ul>

<h4>准备</h4>

<ul>
<li>一台越狱设备</li>
<li>安装OpenSSH MobileSubstrate</li>
</ul>

<h4>步骤</h4>

<ul>
<li><p>首先需要进行qq页面的分析、这个时候就该祭出神器<code>reveal</code>了hhhh</p>

<ul>
<li>把<code>/Applications/Reveal.app/Contents/SharedSupport/iOS-Libraries/Reveal.framework</code>放到<code>/System/Library/Frameworks</code></li>
<li>把<code>/Applications/Reveal.app/Contents/SharedSupport/iOS-Libraries/libReveal.dylib</code>放到<code>/Library/MobileSubstrate/DynamicLibraries</code></li>
<li>在<code>/Library/MobileSubstrate/DynamicLibraries/</code>写一个<code>libReveal.plist</code>文件内容为</li>
</ul>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{   
    Filter = {  
         Bundles = (&quot;com.tencent.mqq&quot;);   
    };   
}  
</code></pre></div>
<ul>
<li>ps. 关于qq的bundle name可以直接去看mediaplist或者注入后自己dump <code>[[NSBundle mainBundle] infoDictionary][@&quot;CFBundleIdentifier&quot;]</code></li>
<li><img src="/assets/static/2015-02-20-1.png" alt="结构嘛= =就是这个样子地!"></li>
</ul></li>
<li><p>接下去开始要真正的搞反向了、我选择了注入了最广泛也是最安全的一个函数<code>viewDidAppear:</code></p>

<ul>
<li>嗯感谢oc的runtime提供强大的方法ˊ_&gt;ˋ</li>
<li> </li>
</ul>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c"><span class="k">static</span> <span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="n">initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  
<span class="p">{</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;---------------inject----------------&quot;</span><span class="p">);</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="n">infoDictionary</span><span class="p">][</span><span class="s">@&quot;CFBundleIdentifier&quot;</span><span class="p">]);</span>

<span class="kt">Class</span> <span class="n">class</span> <span class="o">=</span> <span class="n">objc_getClass</span><span class="p">(</span><span class="s">&quot;UIViewController&quot;</span><span class="p">);</span>
<span class="n">Method</span> <span class="n">ori_Method</span> <span class="o">=</span>  <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="n">viewDidAppear</span><span class="o">:</span><span class="p">));</span>
<span class="n">Method</span> <span class="n">my_Method</span> <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="n">injectedViewDidAppear</span><span class="o">:</span><span class="p">));</span>
<span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">ori_Method</span><span class="p">,</span> <span class="n">my_Method</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>然后我们要找到<code>QQGroupChatViewController</code>然后钩进去=-=记得还要再调一遍原声方法否则要出bug的哟</li>
</ul>
<div class="highlight"><pre><code class="objective-c language-objective-c" data-lang="objective-c"><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">injectedViewDidAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">an</span>
<span class="p">{</span>  
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;-------viewDidAppear entered-------&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">([</span><span class="n">self</span> <span class="n">isKindOfClass</span><span class="o">:</span><span class="n">NSClassFromString</span><span class="p">(</span><span class="s">@&quot;QQGroupChatViewController&quot;</span><span class="p">)])</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="n">injectEntranceccc</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// 现在你已经有viewController 的句柄了哟～～～～！</span>
<span class="p">[</span><span class="n">self</span> <span class="n">injectedViewDidAppear</span><span class="o">:</span><span class="n">an</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>然后找到那个cell了那么以下你有几种选择试验咯具体是哪儿个我也不告诉你=-=

<ul>
<li>找到他的delegate去钩他的didselect方法</li>
<li>找到他下面的UIControl事件模拟touch</li>
<li>看他上面绑定的UIGestureRecognizer然后模拟</li>
</ul></li>
</ul></li>
<li><p>好了我们的注入代码搞定了那么最后该注入进去了咯？</p>

<ul>
<li>首先理论上应该直接用clang进行编译……可是我太菜实在拼不出那坨正确的编译参数所以还是借靠了xcode、随便把注入写进一个<code>x.m</code>然后build起来(记得build要build你机型的那个哦、比如虚拟机上直接跑肯定是x86的我是ipod5所以编译的是armv7)</li>
<li>我们可以在show the report nagivator -&gt; build -&gt; x.m 进行展开看到那一坨又臭又长的编译参数了吧= =我们的目的是要看 -o 然后就找到.o 的目标位置啦</li>
<li>接下去就是链接啦<code>ld -dylib -lsystem -lobjc -syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk -o libij.dylib test.o</code></li>
<li>最后最后！把libij.dylib 塞去<code>/Library/MobileSubstrate/DynamicLibraries/libij.dylib</code> 把 <code>libij.plist</code>塞去哪儿？自己想!</li>
<li>重启-----大功告成</li>
</ul></li>
<li><p>嗯我就是没有给你们<code>injectEntranceccc</code>的实现、总需要有自己的试错嘛=-=</p>

<ul>
<li><img src="/assets/static/2015-02-20-2.jpg" alt="结构嘛= =就是这个样子地!"></li>
</ul></li>
</ul>

<h4>最后</h4>

<ul>
<li>最后最后我再也不会越狱了。。妈蛋我这种菜鸡都可以想搞什么搞什么不用说别人了……</li>
<li>runtime真可怕系列</li>
</ul>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
    
    	<li><a href="#program-ref">
    		program <span>52</span>
    	</a></li>
    
  



    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
    
    	<li><a href="#reverse-ref">reverse <span>1</span></a></li>
    
    	<li><a href="#objective-c-ref">objective-c <span>3</span></a></li>
    
  



    </ul>
  

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/program/2014/10/17/catch-errors-in-rac" title="ReactiveCocoa中RAC绑定中错误处理">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next disabled"><a>Next &rarr;</a>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'snorlaxzxz'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


        </div>
        <hr>
        <footer>
          <p>&copy; 2015 Xinzheng ZhangPowered by Jekyll @ GitHub
          </p>
        </footer>

      </div>
    </div>
    
  </body>
</html>

